
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Build a CineBot with Snowflake Native Apps and Snowflake Cortex</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="build-a-cinebot-with-snowflake-native-apps-and-cortex"
                  title="Build a CineBot with Snowflake Native Apps and Snowflake Cortex"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/sfguides/issues">
    
      <google-codelab-step label="Overview" duration="1">
        <p>The Snowflake Native App Framework is a powerful way for application providers to build, deploy and market applications via the Snowflake Marketplace.  In this example you will learn how to incorporate Snowflake&#39;s Cortex Suite into a Native App that will create a ‘CineBot&#39; that can recommend Movies.</p>
<h2 is-upgraded>Prerequisites</h2>
<ul>
<li>A Snowflake account with ACCOUNTADMIN access</li>
<li>Familiarity with Snowflake Snowsight Interface</li>
<li>Ability to install and run software on your computer</li>
<li>Basic experience using git</li>
</ul>
<h2 class="checklist" is-upgraded>What You&#39;ll Learn</h2>
<ul class="checklist">
<li>How to create an app using the Snowflake Native App framework</li>
<li>How to utilize the Snowflake Cortex Suite and integrate it into a Native App</li>
<li>How to test the Snowflake Native App Provider and Consumer experience within a single Snowflake account</li>
</ul>
<h2 is-upgraded>What You&#39;ll Need</h2>
<ul>
<li>A <a href="https://github.com/" target="_blank">GitHub</a> Account</li>
<li><a href="https://code.visualstudio.com/download" target="_blank">VSCode</a> Installed</li>
<li>A <a href="https://signup.snowflake.com/" target="_blank">Snowflake Account</a></li>
</ul>
<h2 is-upgraded>What You&#39;ll Build</h2>
<ul>
<li>A Snowflake Native App that utilizes the Snowflake Cortex Search and Complete capabilities to create a movie recommendation service aka a ‘CineBot&#39;. You&#39;ll set up an Snowflake account to operate as a Provider and Consumer environment, load data from an S3 bucket into a table and build out the Snowflake Native App.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Snowflake Application Code" duration="5">
        <h2 is-upgraded>Overview</h2>
<p>In preparation for building our Snowflake Native App we need to download the code artifacts for the Native App.</p>
<h2 is-upgraded>Clone or Download Github Repo</h2>
<p>The code for the Native App is on Github. Start by cloning or downloading the repository into a separate folder.</p>
<pre><code language="language-shell" class="language-shell">git clone https://github.com/Snowflake-Labs/sfguide-build-chatbot-with-snowflake-native-app-snowflake-cortex.git
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Native App Provider Setup" duration="5">
        <h2 is-upgraded>Overview</h2>
<p>To simulate a Native App provider experience we will create a role called ‘nactx_role&#39; and grant it the necessary privileges required to create an <a href="https://docs.snowflake.com/en/developer-guide/native-apps/creating-app-package" target="_blank">Application Package</a> as well as create a database that will store our app code.</p>
<h2 is-upgraded>Create NACTX role and Grant Privileges</h2>
<pre><code language="language-sql" class="language-sql">use role accountadmin;
create role if not exists nactx_role;
grant role nactx_role to role accountadmin;
grant create warehouse on account to role nactx_role;
grant create database on account to role nactx_role;
grant create application package on account to role nactx_role;
grant create application on account to role nactx_role with grant option;
</code></pre>
<h2 is-upgraded>Create CORTEX_APP Database to Store Application Files</h2>
<pre><code language="language-sql" class="language-sql">use role nactx_role;
create database if not exists cortex_app;
create schema if not exists cortex_app.napp;
create stage if not exists cortex_app.napp.app_stage;
create warehouse if not exists wh_nap with warehouse_size=&#39;xsmall&#39;;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Native App Consumer Setup" duration="5">
        <h2 is-upgraded>Overview</h2>
<p>To simulate the app consumer experience we will create a role called ‘nac&#39; and grant it the necessary privileges required to create Applications as well as set up a database to house the data we&#39;ll be querying with our Snowflake Native App.</p>
<h2 is-upgraded>Create NAC role and Grant Privileges</h2>
<pre><code language="language-sql" class="language-sql">use role accountadmin;
create role if not exists nac;
grant role nac to role accountadmin;
grant create warehouse on account to role nac;
grant create database on account to role nac;
grant create application on account to role nac;
</code></pre>
<h2 is-upgraded>Create Consumer Test Data Database and Load Data</h2>
<pre><code language="language-sql" class="language-sql">use role nac;
create warehouse if not exists wh_nac with warehouse_size=&#39;medium&#39;;
create database if not exists movies;
create schema if not exists movies.data;
use schema movies.data;

CREATE STAGE MOVIES.DATA.MY_STAGE
URL=&#39;s3://sfquickstarts/vhol_build_2024_native_app_cortex_search/movies_metadata.csv&#39;
DIRECTORY = (
ENABLE = true
AUTO_REFRESH = true
);

CREATE FILE FORMAT MOVIES.DATA.CSV_FILE_FORMAT
	TYPE=CSV
    SKIP_HEADER=1
    FIELD_DELIMITER=&#39;,&#39;
    TRIM_SPACE=TRUE
    FIELD_OPTIONALLY_ENCLOSED_BY=&#39;&#34;&#39;
    REPLACE_INVALID_CHARACTERS=TRUE
    DATE_FORMAT=AUTO
    TIME_FORMAT=AUTO
    TIMESTAMP_FORMAT=AUTO; 

CREATE TABLE movies.data.movies_metadata (
    adult BOOLEAN,
    belongs_to_collection VARCHAR,
    budget NUMBER(38, 0),
    genres VARCHAR,
    homepage VARCHAR,
    id NUMBER(38, 0),
    imdb_id VARCHAR,
    original_language VARCHAR,
    original_title VARCHAR,
    overview VARCHAR,
    popularity VARCHAR,
    poster_path VARCHAR,
    production_companies VARCHAR,
    production_countries VARCHAR,
    release_date DATE,
    revenue NUMBER(38, 0),
    runtime NUMBER(38, 1),
    spoken_languages VARCHAR,
    status VARCHAR,
    tagline VARCHAR,
    title VARCHAR,
    video BOOLEAN,
    vote_average NUMBER(38, 1),
    vote_count NUMBER(38, 0)
);

COPY INTO MOVIES.DATA.MOVIES_METADATA
FROM  @my_stage FILE_FORMAT = (FORMAT_NAME = CSV_FILE_FORMAT) ON_ERROR = CONTINUE;

create or replace table movies_raw as 
select title, budget::string as budget, overview, popularity, release_date::string as release_date, 
runtime::string as runtime 
from movies.data.movies_metadata;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Create Application Package" duration="5">
        <h2 is-upgraded>Overview</h2>
<p>With all of our Snowflake Native App assets uploaded to our Snowflake account we can now create our Application Package using our Provider role.  Since we&#39;re doing this in a single Snowflake account we will also grant the Consumer role privileges to install it.</p>
<h2 is-upgraded>Create Application Package and Grant Consumer Role Privileges</h2>
<pre><code language="language-sql" class="language-sql">use role nactx_role;
create application package cortex_app_pkg;
</code></pre>
<h2 is-upgraded>Upload Native App Code</h2>
<p>After creating the application package we&#39;ll need to upload the Native App code to the the <strong>CORTEX_APP.NAPP.APP_STAGE</strong> stage.  This can be accomplished by navigating to this stage using Snowsight - click on the ‘Database&#39; icon on the left side navigation bar and then on the <strong>CORTEX_APP database &gt; NAPP schema &gt; APP_STAGE stage</strong>.  You will need to do the following:</p>
<ol type="1">
<li>Click on ‘Select Warehouse&#39; and choose ‘WH_NAP&#39; for the Warehouse</li>
<li>Click on the ‘+ Files&#39; button in the top right corner</li>
<li>Browse to the location where you cloned or downloaded the Github repo and into the ‘/app/&#39; folder</li>
<li>Select all 3 files (setup.sql, manifest.yml, readme.md)</li>
<li>Click the ‘Upload&#39; button</li>
<li>Browse back up one level and then go into the ‘/src/&#39; folder</li>
<li>Select both files (ui.py, environment.yaml)</li>
<li>Click the ‘Upload&#39; button</li>
</ol>
<p>When this is done succesfully your we&#39;re now ready to create the Application Package.</p>
<h2 is-upgraded>Alter the Application Package</h2>
<pre><code language="language-sql" class="language-sql">alter application package cortex_app_pkg add version v1 using @cortex_app.napp.app_stage;
grant install, develop on application package cortex_app_pkg to role nac;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Install &amp; Run Application" duration="5">
        <h2 is-upgraded>Overview</h2>
<p>To simulate the app consumer experience we will create a role called ‘nac&#39; and grant it the necessary privileges required to create Applications as well as set up a database to house the data we&#39;ll be querying with our Snowflake Native App.</p>
<h2 is-upgraded>Install App as the Consumer</h2>
<pre><code language="language-sql" class="language-sql">use role nac;
create application cortex_app_instance from application package cortex_app_pkg using version v1;
</code></pre>
<h2 is-upgraded>Grant the Application Privileges on the Movies Table</h2>
<pre><code language="language-sql" class="language-sql">grant all on database movies to application cortex_app_instance;
grant all on schema movies.data to application cortex_app_instance;
grant all on table movies.data.movies_raw to application cortex_app_instance;
grant usage on warehouse wh_nac to application cortex_app_instance;
</code></pre>
<h2 is-upgraded>Grant the Application IMPORTED PRIVILEGES which allows it to use Cortex Functions</h2>
<pre><code language="language-sql" class="language-sql">--This is a special step required to allow Native Apps to utilized Cortex Functions in a consumer database 
use role accountadmin;
GRANT IMPORTED PRIVILEGES ON DATABASE SNOWFLAKE TO APPLICATION cortex_app_instance;
</code></pre>
<h2 is-upgraded>Call the supplied Stored Procedures to process the movies data and build the Cortex Search Service</h2>
<pre><code language="language-sql" class="language-sql">use role nac;
call CORTEX_APP_INSTANCE.CORE.TABLE_CHUNKER();
call CORTEX_APP_INSTANCE.CORE.CREATE_CORTEX_SEARCH();
</code></pre>
<p>At this point you can navigate the the Application by clicking on <strong>‘Data Products&#39;</strong> on the left side of the Snowsight screen and then by clicking on <strong>‘Apps&#39;</strong>.  You can click on the <strong>Cortext_App_Instance</strong> application and it will bring up the chatbot where you can ask it to recommend movies.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Cleanup" duration="2">
        <h2 is-upgraded>Overview</h2>
<p>To clean up your environment you can run the following series of commands.</p>
<h2 is-upgraded>Clean Up</h2>
<pre><code language="language-sql" class="language-sql">--clean up consumer objects
use role NAC;
drop application cortex_app_instance cascade;
drop warehouse wh_nac;
drop database movies;

--clean up provider objects
use role nactx_role;
drop application package cortex_app_pkg;
drop database cortex_app;
drop warehouse wh_nap;

--clean up prep objects
use role accountadmin;
drop role nactx_role;
drop role nac;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Conclusion and Resources" duration="1">
        <p>Congratulations!  You&#39;ve now deployed a Snowflake Native App that utilizes the Snowflake Cortex Suite to enhance the capabilities that a Native App Provider can give to their consumers.</p>
<h2 class="checklist" is-upgraded>What we&#39;ve covered</h2>
<p>In this Quickstart we covered the following:</p>
<ul>
<li>How to create an app using the Snowflake Native App framework</li>
<li>How to utilize the Snowflake Cortex Suite and integrate it into a Native App</li>
<li>How to test the Snowflake Native App Provider and Consumer experience within a single Snowflake account</li>
</ul>
<p>This Quickstart can provide a template for you to accomplish the basic steps of building a Snowflake Native App that includes the Snowflake Cortex Suite to deploy &amp; monetize whatever unique code to your Snowflake consumers accounts.</p>
<h2 is-upgraded>Related Resources</h2>
<ul>
<li><a href="https://www.snowflake.com/en/data-cloud/workloads/applications/native-apps/?_fsi=vZHZai1N&_fsi=vZHZai1N&_fsi=vZHZai1N" target="_blank">Snowflake Native Apps</a></li>
<li><a href="https://docs.snowflake.com/en/developer-guide/native-apps/native-apps-about" target="_blank">Snowflake Native Apps Documentation</a></li>
<li><a href="https://docs.snowflake.com/en/guides-overview-ai-features" target="_blank">Snowpark Cortex</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
