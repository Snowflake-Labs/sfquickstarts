
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Getting Started With User-Defined SQL Functions</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="getting_started_with_user_defined_sql_functions"
                  title="Getting Started With User-Defined SQL Functions"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/devlabs/issues">
    
      <google-codelab-step label="Overview" duration="3">
        <p>User-defined functions (UDFs) let you extend the system to perform operations that are not available through the built-in, system-defined functions provided by Snowflake.</p>
<h3 is-upgraded>Snowflake currently supports the following languages for writing UDFs:</h3>
<ul>
<li><strong>SQL</strong>: A SQL UDF evaluates an arbitrary SQL expression and returns either scalar or tabular results.</li>
<li><strong>JavaScript</strong>: A JavaScript UDF lets you use the JavaScript programming language to manipulate data and return either scalar or tabular results.</li>
<li><strong>Java</strong>: A Java UDF lets you use the Java programming language to manipulate data and return scalar results.</li>
</ul>
<h3 is-upgraded>This guide will walk you through setting up Snowflake and getting familiar with</h3>
<ul>
<li>Creating and executing <strong>SQL</strong> user-defined functions(UDFs)</li>
<li>Creating and executing <strong>SQL</strong> user-defined table functions(UDTFs).</li>
</ul>
<h2 is-upgraded>Prerequisites</h2>
<p>If you are not familiar with the Snowflake User Interface, then please watch the video below.</p>
<ul>
<li>Quick Video <a href="https://www.youtube.com/watch?v=fEtoYweBNQ4&ab_channel=SnowflakeInc." target="_blank">Introduction to Snowflake</a></li>
</ul>
<h2 class="checklist" is-upgraded>What You&#39;ll Learn</h2>
<ul class="checklist">
<li>Snowflake account and user permissions</li>
<li>Creating database objects</li>
<li>Query a user-defined scalar function</li>
<li>Query a user-defined table function</li>
<li>Delete database objects</li>
</ul>
<h2 is-upgraded>What You&#39;ll Need</h2>
<ul>
<li>A <a href="https://signup.snowflake.com/?utm_cta=quickstarts_" target="_blank">Snowflake</a> Trial Account</li>
</ul>
<h2 is-upgraded>What You&#39;ll Build</h2>
<ul>
<li>Database objects and user-defined functions to query those objects.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Begin With the Basics" duration="3">
        <h3 is-upgraded>First, we&#39;ll go over how to create your Snowflake account and manage user permissions.</h3>
<h2 is-upgraded>Create a Snowflake Account</h2>
<p>Snowflake lets you try out their services for free with a <a href="https://signup.snowflake.com/?utm_cta=quickstarts_" target="_blank">trial account</a>. Follow the prompts to activate your account via email.</p>
<p>If you already have a Snowflake account, you can use it.  You just need a role with permission to create a database.</p>
<h2 is-upgraded>Access Snowflake&#39;s Web Console</h2>
<pre><code>https://&lt;your-account-name&gt;.snowflakecomputing.com/console/login
</code></pre>
<p>Log in to the <a href="https://docs.snowflake.com/en/user-guide/connecting.html#logging-in-using-the-web-interface" target="_blank">web interface</a> from your browser. The URL contains your <a href="https://docs.snowflake.com/en/user-guide/connecting.html#your-snowflake-account-name" target="_blank">account name</a> and potentially the region.</p>
<h2 is-upgraded>Changing your role</h2>
<aside class="special"><p>If you already have a Snowflake account, you can use a role with privildges to create a database.</p>
</aside>
<p class="image-container"><img alt="Snowflake_SwitchRole_DemoUser-image" src="img/3270a18bbdd22d31.png"></p>
<p>Switch the account role from the default <code>SYSADMIN</code> to <code>ACCOUNTADMIN</code>. This <strong>is not required</strong>, but will ensure your web UI aligns with the screen shots in this lab.</p>
<p>With your new account created and the role configured, you&#39;re ready to begin creating database objects in the following section.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create Database Objects" duration="5">
        <p>With your Snowflake account at your fingertips, it&#39;s time to create the database objects.</p>
<p>Within the Snowflake web console, navigate to <strong>Worksheets</strong> and use a fresh worksheet to run the following commands.</p>
<h2 is-upgraded>1. Create a new Database</h2>
<pre><code language="language-sql" class="language-sql">create or replace database udf_db;
</code></pre>
<p>Build your new database named <code>udf_db</code> with the command above.</p>
<p class="image-container"><img alt="Snowflake_udf_CreateDB-image" src="img/30d7feb23924bd9b.png"></p>
<aside class="special"><p>The <strong>Results</strong> should display a status message of <strong>Database UDF_DB successfully created</strong> .</p>
</aside>
<h2 is-upgraded>2. Create a new Schema</h2>
<pre><code language="language-sql" class="language-sql">create schema if not exists udf_schema_public;
</code></pre>
<p>Use the above command to whip up a schema called <code>udf_schema_public</code>.</p>
<p class="image-container"><img alt="Snowflake_udf_CreateSchema-image" src="img/ec83a0eafe59a8a8.png"></p>
<aside class="special"><p>The <strong>Results</strong> should display a status message of <strong>Schema UDF_SCHEMA_PUBLIC successfully created</strong>.</p>
</aside>
<h2 is-upgraded>3. Copy Sample Data Into New Table</h2>
<pre><code language="language-sql" class="language-sql">create or replace table udf_db.udf_schema_public.sales 
  as
    (select * from snowflake_sample_data.tpcds_sf10tcl.store_sales sample block (1));

</code></pre>
<p>Create a table named â€˜sales&#39; and import the sales data with this command. Bear in mind, importing the sample data will take a longer time to execute than the previous steps.</p>
<p class="image-container"><img alt="Snowflake_udf_CreateTable-image" src="img/f49a2b0ccc443f63.png"></p>
<aside class="special"><p>The <strong>Results</strong> should display a status of <strong>Table SALES successfully created</strong> .</p>
</aside>
<p>With the necessary database objects created, it&#39;s time to move onto the main course of working with a UDF in the next section.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Execute a Scalar User-Defined Function" duration="6">
        <p>With the database primed with sample sales data, we&#39;re <em>almost</em> ready to try creating a scalar UDF. Before diving in, let&#39;s first understand more about UDF naming conventions.</p>
<aside class="warning"><p>If the function name doesn&#39;t specify the database and schema(e.x. <code>udf_db.udf_schema_public.udf_name</code>) then it defaults to the active session. Since UDFs are database objects, it&#39;s better to follow their <a href="https://docs.snowflake.com/en/sql-reference/udf-overview.html#naming-conventions-for-udfs" target="_blank">naming conventions</a>. For this quick practice, we&#39;ll rely on our active session.</p>
</aside>
<h2 is-upgraded>1. Create UDF</h2>
<pre><code language="language-sql" class="language-sql">create function udf_max()
  returns NUMBER(7,2)
  as
  $$
    select max(SS_LIST_PRICE) from udf_db.udf_schema_public.sales
  $$
  ;
</code></pre>
<p>The <a href="https://docs.snowflake.com/en/sql-reference/functions/min.html#min-max" target="_blank">SQL function</a> <code>max</code> returns the highest value in the column <code>SS_LIST_PRICE</code>.</p>
<p class="image-container"><img alt="Snowflake_udf_max-image" src="img/b23a48ddc8e44e66.png"></p>
<p>The image shows the successful creation of the function <code>udf_max</code>.</p>
<h2 is-upgraded>2. Call the UDF</h2>
<pre><code language="language-sql" class="language-sql">select udf_max();
</code></pre>
<p>Summon your new UDF with the <a href="https://docs.snowflake.com/en/sql-reference/sql/select.html" target="_blank">SQL command</a> <code>select</code>.</p>
<p class="image-container"><img alt="Snowflake_select_udf_max-image" src="img/db1daf03c716803.png"></p>
<p>Pictured above is the returned <strong>Results</strong>.</p>
<p>Now that you&#39;ve practiced the basics of creating a UDF, we&#39;ll kick it up a notch in the next section by creating a UDF that returns a new table.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Query With User-Defined Table Function" duration="6">
        <p>After creating a successful scalar UDF, move onto making a function that returns a table with a UDTF(user-defined table function).</p>
<h2 is-upgraded>1. Create a UDTF</h2>
<pre><code language="language-sql" class="language-sql">create or replace function
udf_db.udf_schema_public.get_market_basket(input_item_sk number(38))
returns table (input_item NUMBER(38,0), basket_item_sk NUMBER(38,0),
num_baskets NUMBER(38,0))
as
 &#39;select input_item_sk, ss_item_sk basket_Item, count(distinct
ss_ticket_number) baskets
from udf_db.udf_schema_public.sales
where ss_ticket_number in (select ss_ticket_number from udf_db.udf_schema_public.sales where ss_item_sk = input_item_sk)
group by ss_item_sk
order by 3 desc, 2&#39;;
</code></pre>
<p>The code snippet above creates a function that returns a table with a market basket analysis.</p>
<p class="image-container"><img alt="Snowflake_udtf-image" src="img/75016e869fe40231.png"></p>
<h2 is-upgraded>2. Run the UDTF</h2>
<pre><code language="language-sql" class="language-sql">select * from table(udf_db.udf_schema_public.get_market_basket(6139));
</code></pre>
<p>Just like for the scalar UDF, this will execute your function.</p>
<p class="image-container"><img alt="Snowflake_select_udtf-image" src="img/553d22dc0d8625ab.png"></p>
<p>Returned is the market basket analysis table based on the sample sales data.</p>
<p>You&#39;ve practiced making UDTFs and have become familiar with UDFs. In the last section, we&#39;ll delete our unneeded database objects.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Cleanup" duration="2">
        <p>We&#39;ve covered a lot of ground! Before we wrap-up, drop the practice database you created in this guide. This will remove the database and all of the tables and functions that you created.</p>
<h2 is-upgraded>1. Drop the Database</h2>
<p>Drop the database: <code>udf_db</code>.</p>
<pre><code language="language-sql" class="language-sql">drop database if exists udf_db;
</code></pre>
<p class="image-container"><img alt="Snowflake_udf_DropDB-image" src="img/318932cf6b70d7d6.png"></p>
<p>Verify the database is entirely gone by checking the <strong>Results</strong> for <code>UDF_DB successfully dropped</code>.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Conclusion and Next Steps" duration="2">
        <p>You should now have a good handle on SQL UDFs by practicing both scalar and table functions. With our database objects cleared, it&#39;s time to look ahead.</p>
<p>Consider the potential of a sharable and <a href="https://docs.snowflake.com/en/sql-reference/udf-secure.html#secure-udfs" target="_blank">secure</a> user-defined function. You can learn how to share user-defined functions, such as the market basket analysis table, following this post about <a href="https://www.snowflake.com/blog/the-power-of-secure-user-defined-functions-for-protecting-shared-data/" target="_blank">the power of secure UDFs</a>.</p>
<h2 class="checklist" is-upgraded>What we&#39;ve covered</h2>
<ul class="checklist">
<li>Registered a Snowflake account</li>
<li>Configured role permissions</li>
<li>Created a database and other objects</li>
<li>Created a table to analyze data with a UDTF</li>
<li>Queried a custom UDF</li>
<li>Droping a database to clean up all objects</li>
</ul>
<h2 is-upgraded>Related Resources</h2>
<p>For more information on UDF&#39;s:</p>
<ul>
<li><a href="https://docs.snowflake.com/en/developer-guide/udf/sql/udf-sql.html#sql-udfs" target="_blank">SQL UDF&#39;s</a></li>
<li><a href="https://docs.snowflake.com/en/developer-guide/udf/javascript/udf-javascript.html#javascript-udfs" target="_blank">JavaScript UDF&#39;s</a></li>
<li><a href="https://docs.snowflake.com/en/developer-guide/udf/java/udf-java.html#java-udfs" target="_blank">Java UDF&#39;s</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
