
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Getting Started with Iceberg in OneLake</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="getting_started_with_iceberg_in_oneLake"
                  title="Getting Started with Iceberg in OneLake"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/sfguides/issues">
    
      <google-codelab-step label="Overview" duration="3">
        <p>Apache Iceberg is an open table format for huge analytical datasets that enables high performance analytics on open data formats with ACID compliance. Snowflake and Azure both support Iceberg format that enables customers to drastically improve data interoperability, speed of implmentation, and peformance for integrated data lakes.</p>
<p>This guide will take you through the steps of converting public data to Iceberg stored within Fabric OneLake storage. Microsoft Fabric is a unified analytics platform that integrates various data services like data engineering, data science, real-time analytics, and business intelligence into a single environment. It allows users to work across the entire analytics lifecycle, from data ingestion and transformation to advanced analytics and reporting. Fabric brings together key technologies like Power BI, Azure Synapse, and Data Factory under one umbrella for seamless data collaboration and processing. Its low-code/no-code tools, along with cloud-scale capabilities, make it accessible for both technical and non-technical users to build, analyze, and share insights. In this quickstart you will be creating a table using the Iceberg table format in OneLake, which can then be queried from both Snowflake and Fabric services.</p>
<h2 is-upgraded>Prerequisites</h2>
<ul>
<li>familiarity with <a href="https://quickstarts.snowflake.com/guide/getting_started_with_snowflake/index.html#0" target="_blank">Snowflake</a> and a Snowflake account</li>
<li>familiarity with <a href="https://learn.microsoft.com/en-us/fabric/get-started/microsoft-fabric-overview" target="_blank">Microsoft Fabric</a> and a Fabric workspace</li>
<li>familiarity with Apache Iceberg</li>
</ul>
<h2 is-upgraded>What You Will Learn</h2>
<ul>
<li>creating an external volumne</li>
<li>using sample data through Snowflake data sharing</li>
<li>creating and populating an Iceberg table managed on OneLake</li>
<li>querying Iceberg from Snowflake and Fabric services</li>
</ul>
<h2 is-upgraded>What You Will Build</h2>
<ul>
<li>You will create an external volume and table using publicly shared sample data. The table will be in the Apache Iceberg table format, deployed in Azure on OneLake. With a Fabric shortcut you will be able to use the data for power BI reports, or other Fabric workloads.</li>
</ul>
<h2 is-upgraded>What You will Need</h2>
<ul>
<li>A free <a href="https://signup.snowflake.com/?utm_cta=quickstarts_" target="_blank">Snowflake Account</a></li>
<li><a href="https://learn.microsoft.com/en-us/fabric/get-started/fabric-trial" target="_blank">Fabric Capacity</a>  <strong>Important: Must be in same region as your Snowflake Account</strong></li>
<li>For the sake of the lab it is best if both platforms have access to the public internet and are not in a virtual network.</li>
</ul>
<p>The end-to-end workflow will look like this: <img src="img/df04be16a7c7579.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Prepare Sample Data" duration="3">
        <p>The first thing you will do is create a database and warehouse in your Snowflake environment. Then create a database for the sample data from a public share in the Data Cloud. Copy and paste the code below to a SQL Worksheet in Snowflake and run through it.</p>
<pre><code language="language-sql" class="language-sql">--create database and warehouse for Iceberg
use role accountadmin;
CREATE OR REPLACE WAREHOUSE HOL_WH WITH WAREHOUSE_SIZE=&#39;X-SMALL&#39;;
CREATE DATABASE SnowflakeQS;
USE DATABASE SnowflakeQS;
CREATE SCHEMA IcebergTest;
USE SCHEMA IcebergTest;

-- Create a database for the sample data from the share.
CREATE DATABASE SNOWFLAKE_SAMPLE_DATA FROM SHARE SFC_SAMPLES.SAMPLE_DATA;

-- Grant the PUBLIC role access to the database.
GRANT IMPORTED PRIVILEGES ON DATABASE SNOWFLAKE_SAMPLE_DATA TO ROLE PUBLIC;

-- View the sample data
SELECT * FROM SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.customer;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Create an Iceberg table in OneLake" duration="15">
        <h2 is-upgraded>Create the External Volume</h2>
<p>Before you create an Iceberg table, you must have an external volume. An external volume is a Snowflake object that stores information about your cloud storage locations, and identity and access management (IAM) entities (in this case, your Entra ID Tenant). Snowflake uses an external volume to establish a connection with your cloud storage in order to access Iceberg metadata and Parquet data.</p>
<p>You will need your OneLake Base URL. To find this in Fabric UI:</p>
<ul>
<li>Go into your Fabric Workspace.</li>
<li>Create a New Item.</li>
<li>Select Lakehouse and name it &#34;snowflakeQS&#34;.</li>
<li>In the Explorer, click the elipses next to Files and then Properties.</li>
<li>In the Properties Menu, copy the URL.</li>
<li>Note: You will replace the https:// from the URL with azure:// in the SQL below. <img src="img/3b9cdc9ca517caf0.png"><img src="img/82684e2c91bb3352.png"></li>
</ul>
<p>Next you will need your Azure Tenant ID. To find this in Fabric UI:</p>
<ul>
<li>In the upper right click on the ? for help &amp; support.</li>
<li>At the bottom click About Fabric (note: this might say About Data Engineering or similar depending on your workspace).</li>
<li>Copy the Tenant URL.  The Tenant ID is the UUID that follows ctid= <img src="img/e56914f60674bea1.png"><img src="img/4ba845cf2508f416.png"></li>
</ul>
<p>Copy this query into Snowflake and fill in the parameters with the collected information.</p>
<pre><code language="language-sql" class="language-sql">CREATE OR REPLACE EXTERNAL VOLUME FabricExVol
  STORAGE_LOCATIONS =
    (
      (
        NAME = &#39;FabricExVol&#39;
        STORAGE_PROVIDER = &#39;AZURE&#39;
        STORAGE_BASE_URL = &#39;azure://onelake.dfs.fabric.microsoft.com/&lt;FabricWorkspaceName&gt;&gt;/&lt;FabricLakehouseName&gt;.Lakehouse/Files/&#39;
        AZURE_TENANT_ID = &#39;&lt;Tenant ID&gt;&#39;
      )
    );
</code></pre>
<h2 is-upgraded>Enabling Permissions</h2>
<p>Now you need to enable Snowflake permission to access your Fabric workspace.</p>
<p>First run the following in Snowflake:</p>
<pre><code language="language-sql" class="language-sql">DESC EXTERNAL VOLUME FabricExVol;
</code></pre>
<p>In the output for property_value of the storage location, in the json you will see a AZURE_MULTI_TENANT_APP_NAME.  This value is the Service Principal that Snowflake uses to connect to Azure. Copy this value. You can remove the underscore and numbers at the end. <img src="img/11afa767a14a36ac.png"></p>
<p>In Fabric, grant the service principal access to your Fabric lakehouse.</p>
<ul>
<li>From the Fabric settings, click on the admin portal.</li>
<li>Scroll down to Developer settings, and under Service Principals can use Fabric APIs, enable this setting. <img src="img/9a80d919f4199e7c.png"></li>
<li>Now open your workspace, click Manage access, then click Add people or groups.</li>
<li>Search for the service principal from the previous step.</li>
<li>Add the service principal as a Contributor. <img src="img/3f0528f400bfaa54.png"></li>
</ul>
<h2 is-upgraded>Create Table</h2>
<p>Back in Snowflake, run the following to create the Iceberg table and insert data from the sample dataset.</p>
<pre><code language="language-sql" class="language-sql">--Create the Iceberg table in OneLake
 CREATE OR REPLACE ICEBERG TABLE snowflakeQS.ICEBERGTEST.dim_customer (
        C_CUSTKEY STRING,
        C_NAME STRING,
        C_ADDRESS STRING,
        C_NATIONKEY STRING,
        C_PHONE STRING,
        C_ACCTBAL STRING,
        C_MKTSEGMENT STRING,
        C_COMMENT STRING
    )
    EXTERNAL_VOLUME = &#39;FabricExVol&#39;
    CATALOG = snowflake
    BASE_LOCATION = &#39;dim_customer&#39;;

--Insert sample data
INSERT INTO SnowflakeQS.ICEBERGTEST.dim_customer
    SELECT top 500 * FROM SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.customer;

--Query the Iceberg table from Snowflake
Select * from SnowflakeQS.ICEBERGTEST.dim_customer
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Accessing the Data in Fabric" duration="10">
        <ol type="1">
<li>In order for Fabric to work on the Iceberg tables, you need to set up shortcuts to the data.</li>
</ol>
<p>Find the location of your Iceberg table in storage. The Iceberg table folder contains a ‘metadata&#39; folder, and that ‘metadata&#39; folder contains a file ending in ‘metadata.json&#39;. If you&#39;re not sure where the table is stored, you can run the following query in Snowflake to discover this information.</p>
<pre><code language="language-sql" class="language-sql">SELECT SYSTEM$GET_ICEBERG_TABLE_INFORMATION(&#39;dim_customer&#39;);
</code></pre>
<p>This will return a path to the metadata file for this table, which should show you which storage account contains the Iceberg table.  For example, this is the relevant info to find the table:</p>
<pre><code>{&#34;metadataLocation&#34;:&#34;azure://&lt;storage_account_path&gt;/&lt;path within storage&gt;/&lt;table name&gt;/metadata/00001-389700a2-977f-47a2-9f5f-7fd80a0d41b2.metadata.json&#34;,&#34;status&#34;:&#34;success&#34;}
</code></pre>
<ol type="1" start="2">
<li>Open the workspace that contains your Fabric lakehouse object.</li>
</ol>
<ul>
<li>Click Workspace settings.</li>
<li>Under Delegated settings, click OneLake settings, and turn on the Authenticate with OneLake user-delegated SAS tokens setting. Note: This is a temporary step – we will remove this as a required step in the near future.</li>
</ul>
<p class="image-container"><img src="img/63c43178a49b03af.png"></p>
<ol type="1" start="3">
<li>In your workspace, open your Fabric lakehouse object.</li>
<li>Click New shortcut from tables.</li>
<li>Select a OneLake Shortcut.</li>
<li>Enter the connection information for your storage location.</li>
<li>Navigate the folder structure and select the checkbox next to your Iceberg table folder to select it as the shortcut target location. Do not select the checkboxes for &#34;data&#34; or &#34;metadata&#34; subfolders.</li>
<li>Click Next and Create your shortcut.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Conclusion and Resources" duration="2">
        <p>Congratulations! You&#39;ve successfully created an Iceberg table in OneLake as a Snowflake data object. You can now use this data for power BI reports, querying from Snowflake, working with Snowpark, working with Synapse Notebooks, and many more use-cases.</p>
<h2 is-upgraded>What You Learned</h2>
<ul>
<li>creating an external volumne</li>
<li>using sample data through Snowflake data sharing</li>
<li>creating and populating an Iceberg table managed on OneLake</li>
<li>querying Iceberg from Snowflake and Fabric services</li>
</ul>
<h2 is-upgraded>Resources</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/power-bi/fundamentals/fabric-get-started" target="_blank">Microsoft Fabric and Power BI</a></li>
<li><a href="https://www.microsoft.com/en-us/microsoft-fabric/blog/2024/05/22/snowflake-and-microsoft-announce-expansion-of-their-partnership/" target="_blank">Fabric and Snowflake together</a></li>
</ul>
<p>If you have any questions, reach out to your Snowflake account team!</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
