
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Analyzing Customer Reviews With Hex and Snowflake Cortex</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="analyzing_customer_reviews_using_hex_and_snowflake_cortex"
                  title="Analyzing Customer Reviews With Hex and Snowflake Cortex"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/sfguides/issues">
    
      <google-codelab-step label="Overview" duration="5">
        <p>This quickstart guide has been slightly modified from the original quickstart guide titled <a href="https://quickstarts.snowflake.com/guide/customer_reviews_analytics_using_snowflake_cortex/#0" target="_blank">Customer Reviews Analytics using Snowflake Cortex</a>.</p>
<p>We will be exploring customer review data using Snowflake Cortex and Hex. Specifically, we will create a data app that leverages Snowflake&#39;s Cortex LLM functions to better understand our customer feedback. As a result we will then be able to provide recommendations and improvements to our stakeholders.</p>
<h2 is-upgraded>Prerequisites</h2>
<ul>
<li>Familiarity with basic Python and SQL</li>
<li>Familiarity with data science notebooks</li>
<li>A <a href="https://signup.snowflake.com/?utm_cta=quickstarts_" target="_blank">Snowflake</a> account (if you are using an enterprise account through your organization, ensure that you have permissions to write data to a database).</li>
</ul>
<h2 is-upgraded>What You Will Learn</h2>
<ul>
<li>How to leverage Snowflake&#39;s Cortex LMM functionality</li>
<li>Data exploration and analysis of customer reviews using Snowflake Cortex.</li>
<li>How to best utilize single-shot versus zero-shot prompting</li>
<li>Perform sentiment analysis and classification at scale.</li>
<li>How to turn a Hex notebook into a Hex data app</li>
</ul>
<h2 is-upgraded>What You Will Build</h2>
<p>You will create a Hex data app that uses Snowflake Cortex and Hex to analyze customer reviews, providing interactive insights and recommendations to our stakeholders.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Setting up partner connect" duration="5">
        <p>If you have an existing Hex account, login to your Hex account and continue to the next section. Otherwise, follow the steps below.</p>
<p>After logging into your Snowflake account, you will land on the <code>Learn</code> page. To connect with Hex, navigate to the <code>Admin</code> tab on the left and click on <code>Partner connect</code>. In the search bar at the top, type <code>Hex</code> and the Hex partner connect tile will appear. Clicking on the tile will bring up a new screen,  click the <code>connect button</code> in the lower right corner. A new screen will confirm that your account has been created, from which you can click <code>Activate</code>.</p>
<p class="image-container"><img src="img/cd6cfdab98dd48c8.gif"></p>
<h3 is-upgraded>Creating a workspace</h3>
<p>Once activated, you&#39;ll be brought over to Hex and will be prompted to create/name your new workspace.</p>
<h3 is-upgraded>Workflow roadblocks</h3>
<p>The following issues may occur if you have an existing Hex account and you&#39;re not an Admin in that org.</p>
<p><strong>Unauthorized error</strong></p>
<p>If you have an existing Hex account that was created with a password and username, you may run into an &#34;Unauthorized&#34; error when activating your workspace in Partner Connect. If this is your experience, head over to <a href="https://hex.tech" target="_blank">hex.tech</a> and login with your password and username.</p>
<p><strong>Plan upgrade</strong></p>
<p>If you are an existing Hex user currently on a Community plan, you may encounter an issue that will prevent you from using Partner Connect. If you&#39;re unclear on what Hex plan you are on, feel free to reach out to <a href="mailto:support@hex.tech" target="_blank">support@hex.tech</a>. If you are the Admin of your organization, you can see your plan under Manage plan on the Settings page. To extend a trial, email <a href="mailto:support@hex.tech" target="_blank">support@hex.tech</a> with the subject &#34;Snowflake Quickstart Guide.&#34;</p>
<p><strong>Role privileges</strong></p>
<p>If you do not have an Editor role or higher, you won&#39;t be able to create data connections in your workspace. To upgrade your role, contact your workspace Admin. You can find out who this is by navigating to Settings -&gt; Users &amp; groups within your Hex workspace.</p>
<p><em>If you&#39;re still encountering issues, or encounter any issues other than the ones listed above, please contact our support team </em><a href="mailto:support@hex.tech" target="_blank"><em>support@hex.tech</em></a><em> with the subject &#34;VHOL&#34; for priority support.</em></p>


      </google-codelab-step>
    
      <google-codelab-step label="Getting Started with Hex" duration="5">
        <p>The first thing you&#39;ll need to do is transfer the Hex project into your new or existing Hex org.</p>
<p><a href="https://app.hex.tech/hex-public/hex/f9d33968-081d-4472-9f52-95f9739df071/draft/logic" target="_blank"><paper-button class="colored" raised>Get Hex project</paper-button></a></p>
<ul>
<li>Select Get a copy.</li>
<li>Select your new or existing Hex org.</li>
</ul>
<p>Now that you&#39;ve got your project, you will find yourself in the Notebook view of a Hex project. The Notebook view is a notebook-like interface made up of cells such as code cells, markdown cells, input parameters and more! On the far left side, you&#39;ll see a control panel that will allow you to do things like upload files, import data connections, or search your project. Before we dive into the code, we&#39;ll need to import our Snowflake connection to our project.</p>
<p>We can import our Snowflake data connection by heading over to the <code>Data sources</code> tab represented by a database icon with a lightning bolt. At the bottom of this section, you&#39;ll see a portion that says available workspace connections and you should see one that says Snowflake if you created the Hex account via Partner Connect.</p>
<p class="image-container"><img src="img/c50263f87d45efee.png"></p>
<p>If you had an existing Hex org and did not create one via Partner Connect please follow <a href="https://learn.hex.tech/docs/connect-to-data/data-connections/data-connections-introduction" target="_blank">Hex documentation</a> on creating a Snowflake connection or use an existing Snowflake connection with write permissions.</p>
<h2 is-upgraded>Common Problems</h2>
<p>If coming from Partner Connect or creating a new database connection, ensure that your database connection has both the Snowpark and Writeback toggle enabled. Navigate to the Settings in Hex and select the desired Snowflake database connection.</p>
<p class="image-container"><img src="img/29fd60000b1c6a7.png"></p>
<p>Enable the Snowpark and Writeback toggles.</p>
<p class="image-container"><img src="img/570ccb3932397808.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Writing Data To Snowflake" duration="5">
        <p><strong><em>NOTE: The Hex project is designed to be paired with the quickstart guide, please ensure to follow the quickstart guide as it will provide additional information and highlight the most important concepts!</em></strong></p>
<p>Go to the Hex project to create the required Snowflake objects and write the data to your Snowflake account using the SQL code below. This SQL can be found in the first SQL cell in the Hex project. Ensure that you have selected your Snowflake account at the top right of the SQL cell as seen below:</p>
<p class="image-container"><img src="img/96bbbd8ab8e68e5a.png"></p>
<p><strong><em>NOTE: Your Snowflake data connection may be a custom name if you have not gone through Partner Connect.</em></strong></p>
<p>Run the SQL cell with the play button found at the top right of the SQL cell. Below you will find the entire SQL script:</p>
<pre><code language="language-sql" class="language-sql">-- create tb_voc database
CREATE OR REPLACE DATABASE tb_voc;

-- create raw_pos schema
CREATE OR REPLACE SCHEMA tb_voc.raw_pos;

-- create raw_customer schema
CREATE OR REPLACE SCHEMA tb_voc.raw_support;

-- create harmonized schema
CREATE OR REPLACE SCHEMA tb_voc.harmonized;

-- create analytics schema
CREATE OR REPLACE SCHEMA tb_voc.analytics;

-- create tasty_ds_wh warehouse
CREATE OR REPLACE WAREHOUSE tasty_ds_wh
    WAREHOUSE_SIZE = &#39;large&#39;
    WAREHOUSE_TYPE = &#39;standard&#39;
    AUTO_SUSPEND = 60
    AUTO_RESUME = TRUE
    INITIALLY_SUSPENDED = TRUE
COMMENT = &#39;data science warehouse for tasty bytes&#39;;


USE WAREHOUSE tasty_ds_wh;

/*--
 • file format and stage creation
--*/

CREATE OR REPLACE FILE FORMAT tb_voc.public.csv_ff 
type = &#39;csv&#39;;

CREATE OR REPLACE STAGE tb_voc.public.s3load
COMMENT = &#39;Quickstarts S3 Stage Connection&#39;
url = &#39;s3://sfquickstarts/tastybytes-voc/&#39;
file_format = tb_voc.public.csv_ff;

/*--
 raw zone table build 
--*/

-- menu table build
CREATE OR REPLACE TABLE tb_voc.raw_pos.menu
(
    menu_id NUMBER(19,0),
    menu_type_id NUMBER(38,0),
    menu_type VARCHAR(16777216),
    truck_brand_name VARCHAR(16777216),
    menu_item_id NUMBER(38,0),
    menu_item_name VARCHAR(16777216),
    item_category VARCHAR(16777216),
    item_subcategory VARCHAR(16777216),
    cost_of_goods_usd NUMBER(38,4),
    sale_price_usd NUMBER(38,4),
    menu_item_health_metrics_obj VARIANT
);

-- truck table build 
CREATE OR REPLACE TABLE tb_voc.raw_pos.truck
(
    truck_id NUMBER(38,0),
    menu_type_id NUMBER(38,0),
    primary_city VARCHAR(16777216),
    region VARCHAR(16777216),
    iso_region VARCHAR(16777216),
    country VARCHAR(16777216),
    iso_country_code VARCHAR(16777216),
    franchise_flag NUMBER(38,0),
    year NUMBER(38,0),
    make VARCHAR(16777216),
    model VARCHAR(16777216),
    ev_flag NUMBER(38,0),
    franchise_id NUMBER(38,0),
    truck_opening_date DATE
);

-- order_header table build
CREATE OR REPLACE TABLE tb_voc.raw_pos.order_header
(
    order_id NUMBER(38,0),
    truck_id NUMBER(38,0),
    location_id FLOAT,
    customer_id NUMBER(38,0),
    discount_id VARCHAR(16777216),
    shift_id NUMBER(38,0),
    shift_start_time TIME(9),
    shift_end_time TIME(9),
    order_channel VARCHAR(16777216),
    order_ts TIMESTAMP_NTZ(9),
    served_ts VARCHAR(16777216),
    order_currency VARCHAR(3),
    order_amount NUMBER(38,4),
    order_tax_amount VARCHAR(16777216),
    order_discount_amount VARCHAR(16777216),
    order_total NUMBER(38,4)
);

-- truck_reviews table build
CREATE OR REPLACE TABLE tb_voc.raw_support.truck_reviews
(
    order_id NUMBER(38,0),
    language VARCHAR(16777216),
    source VARCHAR(16777216),
    review VARCHAR(16777216),
    review_id NUMBER(18,0)
);

/*--
 • harmonized view creation
--*/

-- truck_reviews_v view
CREATE OR REPLACE VIEW tb_voc.harmonized.truck_reviews_v
    AS
SELECT DISTINCT
    r.review_id,
    r.order_id,
    oh.truck_id,
    r.language,
    source,
    r.review,
    t.primary_city,
    oh.customer_id,
    TO_DATE(oh.order_ts) AS date,
    m.truck_brand_name
FROM tb_voc.raw_support.truck_reviews r
JOIN tb_voc.raw_pos.order_header oh
    ON oh.order_id = r.order_id
JOIN tb_voc.raw_pos.truck t
    ON t.truck_id = oh.truck_id
JOIN tb_voc.raw_pos.menu m
    ON m.menu_type_id = t.menu_type_id;

/*--
 • analytics view creation
--*/

-- truck_reviews_v view
CREATE OR REPLACE VIEW tb_voc.analytics.truck_reviews_v
    AS
SELECT * FROM harmonized.truck_reviews_v;


/*--
 raw zone table load 
--*/


-- menu table load
COPY INTO tb_voc.raw_pos.menu
FROM @tb_voc.public.s3load/raw_pos/menu/;

-- truck table load
COPY INTO tb_voc.raw_pos.truck
FROM @tb_voc.public.s3load/raw_pos/truck/;

-- order_header table load
COPY INTO tb_voc.raw_pos.order_header
FROM @tb_voc.public.s3load/raw_pos/order_header/;

-- truck_reviews table load
COPY INTO tb_voc.raw_support.truck_reviews
FROM @tb_voc.public.s3load/raw_support/truck_reviews/;


-- scale wh to medium
ALTER WAREHOUSE tasty_ds_wh SET WAREHOUSE_SIZE = &#39;Medium&#39;;

-- setup completion note
SELECT &#39;setup is now complete&#39; AS note;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Hex Quickstart Guide Best Practices" duration="1">
        <p>Below is a short list of suggestions:</p>
<ul>
<li>You may safely delete the SQL cell previously ran from the Hex project or comment it out. Once completed, you may select Run all at the top right of the Hex project or step through each code cell and run them individually. The ladder is the recommended approach.</li>
<li>By default, Hex will run in <a href="https://learn.hex.tech/docs/explore-data/projects/compute-model/run-modes-and-cell-staleness#run-modes" target="_blank">Auto mode</a> which automatically runs depended downstream cells. You can edit this project behavior at the bottom right of the Hex project.</li>
<li>Ensure that every SQL cell has the correct Snowflake database connection selected prior to running it.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Working With Snowpark In Hex" duration="15">
        <p>Hex offers a straightforward and secure way to interact with Snowpark. To quickly return a Snowpark dataframe, simply select the Snowpark return mode from the next SQL cell in your Hex project. The output of this SQL cell will be a Snowpark dataframe named <code>reviews</code>, which you can easily rename by clicking on the highlighted variable in blue.</p>
<p class="image-container"><img src="img/3c784e9d77e825c4.png"></p>
<p>Additionally, Hex provides native visualizations for Snowpark dataframes. Simply pass them into a Hex native chart and see your data! Hex charts construct the appropriate query to render the chart appropriately and only bring the result set into Hex memory!</p>
<p class="image-container"><img src="img/dc1c237527cccd9a.png"></p>
<p>Notice that the <code>reviews</code> Snowpark dataframe is highlighted in blue at the top left of the chart. This chaining effect allows you to use the same dataframe across various cells throughout the project, all managed seamlessly by Hex. Whether you&#39;re using a Snowpark or a pandas dataframe, Hex handles the complexities for you. Finally, Snowpark dataframes are denoted in blue, except when utilized within a Python cell.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Generate A Snowpark Session In Hex" duration="0">
        <p>To work with a Snowpark session object, select your database connection from the data browser tab on the left side of the Hex project. A <code>query</code> option will be visible, allowing for quick queries to this connection in an SQL cell. Click the dropdown next to the <code>query</code> button and select <code>Get Snowpark session</code>. This action will create a new Python cell with the necessary code to obtain a Snowpark session. Hex utilizes the <code>hextoolkit</code> library to securely access your existing Snowflake connection, providing a clean and secure way to authenticate and establish a Snowpark session.</p>
<p><em>The cell created by this button will be positioned under the cell that is currently selected.</em></p>
<p class="image-container"><img src="img/756e6cdd71876139.png"></p>
<p>Scope the Snowpark session to the appropriate database and schema. If you are using a different database and schema name, scope the Snowpark session to the correct database and schema.</p>
<pre><code language="language-python" class="language-python">session.use_database(&#34;tb_voc&#34;)
session.use_schema(&#34;analytics&#34;)
</code></pre>
<p>At this time, complete the Hex project until you reach the section titled Snowflake Cortex. At that time, move to the next quickstart guide section titled Working With Snowflake Cortex in Hex.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Working with Snowflake Cortex in Hex" duration="45">
        <p><a href="https://docs.snowflake.com/en/guides-overview-ai-features" target="_blank">Snowflake Cortex AI</a> is an intelligent, fully managed service that provides access to industry-leading large language models (LLMs) and chat with your data services. Cortex AI capabilities include:</p>
<p class="image-container"><img src="img/928f1cde2f98f533.png"></p>
<p>For this quickstart guide, a specific focus will be placed on <a href="https://docs.snowflake.com/en/user-guide/snowflake-cortex/llm-functions" target="_blank">Snowflake Cortex LLM Functions</a> which fall under the Task-Specific offering. The functions that will be explored in this quickstart guide are:</p>
<ul>
<li><a href="https://docs.snowflake.com/en/user-guide/snowflake-cortex/llm-functions#label-cortex-llm-translate" target="_blank">TRANSLATE</a></li>
<li><a href="https://docs.snowflake.com/en/user-guide/snowflake-cortex/llm-functions#label-cortex-llm-complete" target="_blank">COMPLETE</a></li>
<li><a href="https://docs.snowflake.com/en/user-guide/snowflake-cortex/llm-functions#label-cortex-llm-sentiment" target="_blank">SENTIMENT</a></li>
</ul>
<p>Below is some Snowpark code that quickly translates our customer reviews into English. In the line calling <code>cortex.Translate</code>, the first and second arguements are the column inputs of the customer review in plain text and the source language respectively. The English language is specifed as the target language by <code>en</code>. This is the third argument for the <code>Translate</code> function.</p>
<pre><code language="language-python" class="language-python"># Conditionally translate reviews that are not english using Cortex Translate
reviews_24 = reviews_24.withColumn(
    &#34;TRANSLATED_REVIEW&#34;,
    when(
        F.col(&#34;LANGUAGE&#34;) != F.lit(&#34;en&#34;),
        cortex.Translate(F.col(&#34;REVIEW&#34;), F.col(&#34;LANGUAGE&#34;), &#34;en&#34;),
    ).otherwise(F.col(&#34;REVIEW&#34;)),
)

reviews_24.filter(F.col(&#34;LANGUAGE&#34;) != F.lit(&#34;en&#34;)).select(
    [&#34;REVIEW&#34;, &#34;LANGUAGE&#34;, &#34;TRANSLATED_REVIEW&#34;]
).show(3)
</code></pre>
<p>This capability allows for LLMs to be easily utilized in conditional statements and at scale. Continue in the Hex project until you reach the <strong>Single-Shot vs. Zero-Shot Prompting</strong> section, and then proceed to the next section.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Single-Shot vs. Zero-Shot Prompting" duration="10">
        <p><strong>Single-Shot Prompting:</strong> Providing the model with one example of the task to guide it, helping clarify the desired output or format before requesting a response.</p>
<p><strong>Zero-Shot Prompting:</strong> Asking a model to perform a task without providing any prior examples, relying on its built-in knowledge and context understanding.</p>
<p>Use zero-shot for general tasks and single-shot when an example can help improve accuracy or clarify expectations. Let&#39;s explore this in action:</p>
<h2 is-upgraded>Single-Shot Prompting</h2>
<pre><code language="language-python" class="language-python"># Prompt to get a rating based on a customer review
# We provide one shot in-context learning to better the answers we get from LLM
prompt = &#34;&#34;&#34;[INST]
### 
You are tasked with rating cutsomer reviews for global food truck network called tasty bytes. \
Rating can be one of the following - awful, poor, okay, good, excellent such that awful is the worst \
possible rating and excellent is the best possible rating. Include only the rating in the output \
without any additional text. \
Rate the following review:
The &#34;Freezing Point&#34; ice cream truck in Seoul offered a mix of classic and unique \
options. The Sugar Cone and Waffle Cone were both fresh and crisp, providing a satisfying crunch. The \
Bottled Water and Ice Tea were standard, as expected. The standout, however, was the Mango Sticky Rice \
- a delightful blend of sweet and tangy, it was a refreshing twist to the usual ice cream flavors. The \
service was efficient, but lacked a personal touch. Overall, it\&#39;s a decent choice for a quick, cool \
treat in the city.
Rating : good
Rate the following review: 
###&#34;&#34;&#34;

# Ask cortex complete and create a new column
reviews_rated = reviews_24.withColumn(
    &#34;RATING&#34;,
    cortex.Complete(
        model, F.concat(F.lit(prompt), F.col(&#34;REVIEW&#34;), F.lit(&#34;&#34;&#34;[/INST]&#34;&#34;&#34;))
    ),
).withColumn(
    &#34;CLEAN_RATING&#34;,
    when(F.contains(F.lower(F.col(&#34;RATING&#34;)), F.lit(&#34;awful&#34;)), F.lit(&#34;awful&#34;))
    .when(F.contains(F.lower(F.col(&#34;RATING&#34;)), F.lit(&#34;poor&#34;)), F.lit(&#34;poor&#34;))
    .when(F.contains(F.lower(F.col(&#34;RATING&#34;)), F.lit(&#34;okay&#34;)), F.lit(&#34;okay&#34;))
    .when(F.contains(F.lower(F.col(&#34;RATING&#34;)), F.lit(&#34;good&#34;)), F.lit(&#34;good&#34;))
    .when(F.contains(F.lower(F.col(&#34;RATING&#34;)), F.lit(&#34;excellent&#34;)), F.lit(&#34;excellent&#34;))
    .otherwise(F.lit(&#34;unsure&#34;)),
)

reviews_rated.select([&#34;REVIEW&#34;, &#34;CLEAN_RATING&#34;]).show(3)
</code></pre>
<h2 is-upgraded>Zero-Shot Prompting</h2>
<pre><code language="language-python" class="language-python"># Prompt to understand whether a customer would recommend food truck based on their review
prompt = &#34;&#34;&#34;[INST]
### 
Tell me based on the following food truck customer review, will they recommend the food truck to \
their friends and family? Answer should be only one of the following words - \
&#34;Likely&#34; or &#34;Unlikely&#34; or &#34;Unsure&#34;. Make sure there are no additional additional text.
Review -
###&#34;&#34;&#34;

# Ask cortex complete and create a new column
reviews_24 = reviews_24.withColumn(
    &#34;RECOMMEND&#34;,
    cortex.Complete(
        &#34;snowflake-arctic&#34;,
        F.concat(F.lit(prompt), F.col(&#34;REVIEW&#34;), F.lit(&#34;&#34;&#34;[/INST]&#34;&#34;&#34;)),
    ),
).withColumn(
    &#34;CLEAN_RECOMMEND&#34;,
    when(F.contains(F.col(&#34;RECOMMEND&#34;), F.lit(&#34;Likely&#34;)), F.lit(&#34;Likely&#34;))
    .when(F.contains(F.col(&#34;RECOMMEND&#34;), F.lit(&#34;Unlikely&#34;)), F.lit(&#34;Unlikely&#34;))
    .when(F.contains(F.col(&#34;RECOMMEND&#34;), F.lit(&#34;Unsure&#34;)), F.lit(&#34;Unsure&#34;))
    .otherwise(F.lit(&#34;NA&#34;)),
)

reviews_24.select([&#34;REVIEW&#34;, &#34;CLEAN_RECOMMEND&#34;]).show(3)
</code></pre>
<p>Both approaches provide quality results, that said for defined tasks providing additional context in the form of single-shot prompting is recommeneded.</p>
<h2 is-upgraded>Model Selection</h2>
<p>Note that in the first code cell above, a variable called <code>model</code> is used. This is to allow for quick testing and optimization of model selection with respect to accuracy and cost. The model variable is a string input defined by a <a href="https://learn.hex.tech/docs/explore-data/cells/input-cells/dropdown-inputs" target="_blank">dropdown cell</a> in Hex. The following models are available in Snowflake at the time of writing:</p>
<pre><code language="language-python" class="language-python"># the available models in Snowflake as of Oct. 18th 2024
models = [
    &#34;gemma-7b&#34;,
    &#34;jamba-1.5-mini&#34;,
    &#34;jamba-1.5-large&#34;,
    &#34;jamba-instruct&#34;,
    &#34;llama2-70b-chat&#34;,
    &#34;llama3-8b&#34;,
    &#34;llama3-70b&#34;,
    &#34;llama3.1-8b&#34;,
    &#34;llama3.1-70b&#34;,
    &#34;llama3.1-405b&#34;,
    &#34;llama3.2-1b&#34;,
    &#34;llama3.2-3b&#34;,
    &#34;mistral-large&#34;,
    &#34;mistral-large2&#34;,
    &#34;mistral-7b&#34;,
    &#34;mixtral-8x7b&#34;,
    &#34;reka-core&#34;,
    &#34;reka-flash&#34;,
    &#34;snowflake-arctic&#34;
]
</code></pre>
<p>Return to the Hex project and complete the cells until you reach the <strong>Classification Analysis</strong> section. Once there, progress to the next section in the quickstart guide.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Classification Using Cortex" duration="5">
        <p>Performing classification was once a rather complex task requiring supervised machine learning where labeled data was used to train models to recognize patterns and categorize inputs. This involved collecting large datasets, preprocessing them, and training models like decision trees, SVMs, or neural networks, which could be time-consuming and resource-intensive. Today, with large language models (LLMs), we can perform classification without explicit training data or supervision by simply prompting the model.</p>
<p>In the prompt below, specific instructions are provided as well as a single-shot prompt. By passing this additional context, the LLM provides consistent, repeatable results such that we can reliably use this at scale.</p>
<pre><code language="language-python" class="language-python"># Prompt to understand sentiment for different categories mentioned in the customer review
# We employ one shot incontext learning to inform LLM
prompt = &#34;&#34;&#34;[INST]
### 
You are analyzing food-truck customer reviews to undertsand what a given review says about different relevant categories like \
food quality, menu options, staff, overall experience, price, ambience, customer support, \
hygiene standards etc and if sentiment is negative,positive or neutral for that category. \
Only answer in a single valid JSON containing &#34;category&#34;, &#34;sentiment&#34; and &#34;details&#34;. \
Make sure there is no additional text and not mention categories in answer which are not \
talked in the review. \
Get category based sentiment for the follwoing customer review:
&#34;This food truck offers a disappointing experience. \
The menu lacks healthy options and the food quality is subpar. Finding a parking spot near the \
truck can also be a frustrating ordeal. Additionally, the value for money is not worth it. To top \
it all off, the service provided at this food truck is less than pleasant, adding to the overall \
negative dining experience. Tried reaching out the customer support but was unable to get through.&#34; 
Answer : [{     &#34;category&#34;: &#34;food quality&#34;,     &#34;sentiment&#34;: &#34;negative&#34;,    &#34;details&#34;: &#34;subpar quality&#34;   }, {     &#34;category&#34;: &#34;menu options&#34;,     &#34;sentiment&#34;: &#34;negative&#34;,     &#34;details&#34;: &#34;lacks healthy options&#34;   },   {     &#34;category&#34;: &#34;staff&#34;,     &#34;sentiment&#34;: &#34;negative&#34;,     &#34;details&#34;: &#34;unpleasant&#34;   },   {     &#34;category&#34;: &#34;price&#34;,     &#34;sentiment&#34;: &#34;negative&#34;,     &#34;details&#34;: &#34;not worth the money&#34;   },   {     &#34;category&#34;: &#34;experience&#34;,     &#34;sentiment&#34;: &#34;negative&#34;,     &#34;details&#34;: &#34;regrettable dining experience&#34;   },   {     &#34;category&#34;: &#34;customer support&#34;,     &#34;sentiment&#34;: &#34;negative&#34;,     &#34;details&#34;: &#34;unable to get through&#34;   } ].
Get category based sentiment for the following customer review:
###&#34;&#34;&#34;

# Ask Cortex Complete and create a new column
review_df = reviews_24.withColumn(
    &#34;CATEGORY_SENTIMENT&#34;,
    cortex.Complete(
        &#34;mixtral-8x7b&#34;,
        F.concat(F.lit(prompt), F.col(&#34;REVIEW&#34;), F.lit(&#34;&#34;&#34;Answer:[/INST]&#34;&#34;&#34;)),
    ),
)
review_df.select([&#34;REVIEW&#34;, &#34;CATEGORY_SENTIMENT&#34;]).show(1)
</code></pre>
<p>Complete the rest of the Hex project and progress to the next quickstart section to build your own Hex App!</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create A Hex App" duration="5">
        <p>Congratulations on successfully completing the Hex project! Now is the perfect time to share these insights with the team. However, simply sharing the technical analysis and code cells with stakeholders may not be the most effective approach. Traditional workflows, such as using BI tools for showing visuals or embedding screenshots in PowerPoint or PDF have proven to be very tedious for ad hoc analytical work. Often times, this workflow results in incomplete communication, leaving end users with more questions than answers.</p>
<p>To address this, we can create a Hex app that presents our findings in an interactive format, enabling stakeholders to explore the results without needing to navigate through the underlying code cells. Since the app is powered by the notebook cells we&#39;ve created, it ensures that all end users have access to the most up-to-date information.</p>
<p>Navigate to the App builder located at the top of the Hex project. Every Hex project automatically creates a Hex app by default, but you may use this <a href="https://app.hex.tech/hex-public/app/f9d33968-081d-4472-9f52-95f9739df071/latest" target="_blank">project as a template</a>. To easily transfer elements from the notebook to the App builder, press <strong>CTRL + Click</strong> on the Notebook button to enable split-screen view:</p>
<p class="image-container"><img src="img/b2854837c186d7bf.png"></p>
<p>In split-screen mode, you can view the notebook cells and conveniently add the relevant cells to the App builder:</p>
<p class="image-container"><img src="img/641b6d0a8909895a.png"></p>
<p>Once a cell is added to the App builder, you can drag and drop, resize, or modify it directly within the App builder. You can also create entirely new cells while designing your data app. The Notebook and App builder are intertwined—any changes made on one side will be reflected on the other.</p>
<p>With the project complete and ready to share:</p>
<ul>
<li>Publish the app with the <a href="https://learn.hex.tech/docs/share-insights/apps/publish-and-share-apps" target="_blank">Publish button</a></li>
<li>Hex will run the entire project to ensure there are no errors</li>
<li>Click the share button at the top right and choose <code>Publish to web</code></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Conclusion and Resources" duration="0">
        <p>Congratulations on completing this lab! You&#39;ve successfully leveraged Hex and Cortex to generate insights from text data at scale—something that traditionally would have required extensive expertise and countless hours of work. This project highlights how modern workflows, powered by LLMs, can streamline and accelerate tasks that once took significant time, making advanced data analysis more accessible and efficient today.</p>
<h2 is-upgraded>What You Learned</h2>
<ul>
<li>How to analyze customer feedback using Snowflake Cortex and Hex.</li>
<li>Leveraging LLMs for tasks like translation and sentiment analysis.</li>
<li>Differences between single-shot and zero-shot prompting.</li>
<li>Turning a Hex notebook into an interactive data app.</li>
<li>Easily sharing findings with stakeholders via a Hex app.</li>
</ul>
<h2 is-upgraded>Related Resources</h2>
<ul>
<li><a href="https://app.hex.tech/810c3d49-47a5-470c-9eaa-f471548c9620/app/af138a51-cae9-4300-9aee-6805afe6e699/latest" target="_blank">Final Project</a></li>
<li><a href="https://developers.snowflake.com/solution/data-exploration-with-hex-and-snowpark/" target="_blank">Data Exploration &amp; Analysis using Hex and Snowpark</a></li>
<li><a href="https://hex.tech/blog/multi-modal-analytics/" target="_blank">The Future of Analytics is Multi-Modal</a></li>
<li><a href="https://hex.tech/templates/snowpark/analysis-of-customer-purchasing-behavior/" target="_blank">Customer Behavior Analysis and New Product Sales Forecasting</a></li>
<li><a href="https://docs.snowflake.com/en/guides-overview-ai-features" target="_blank">Snowflake Cortex Documentaion</a></li>
<li><a href="https://quickstarts.snowflake.com/guide/getting_started_with_synthetic_data_and_distillation_for_llms/#0" target="_blank">Getting Started with Llama 3.1 405B: Build Custom LLMs with Synthetic Data Generation and Distillation</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
