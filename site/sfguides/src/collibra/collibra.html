<!DOCTYPE html>
<html>
<head>
<title>collibra.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<p>author:
id: collibra
summary: This is a sample Snowflake Guide to show how a user can work with Collibra in integration with Snowflake.
categories: Getting-Started
environments: web
status: Published
feedback link: https://github.com/Snowflake-Labs/sfguides/issues
tags: Getting Started, Data Science, Data Engineering, Twitter</p>
<h1 id="collibra-data-governance-with-snowflake">Collibra Data Governance with Snowflake</h1>
<!-- ------------------------ -->
<h2 id="overview">Overview</h2>
<p>Duration: 1</p>
<p>This is a guide on how to catalog Snowflake data into Collibra, link the data to business and logical context, create and enforce policies. Also we will show how a user can search and find data in Collibra, request access and go directly to the data in Snowflake with access policies automatically enforced.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Access to Snowflake database</li>
<li>Access to a Collibra instance. Please reach out to:</li>
</ul>
<h3 id="what-youll-learn">What You’ll Learn</h3>
<ul>
<li>how to catalog Snowflake data in Collibra</li>
<li>how to connect the metadata into a data domain and business and logical data attributes</li>
<li>how to enforce data privacy policies on the Snwoflake data</li>
<li>how to search for data in Collibra</li>
<li>how to request access of Snowflake data in Collibra and view data with policies enforced</li>
</ul>
<h3 id="what-youll-need">What You’ll Need</h3>
<ul>
<li>A Snowflake instance</li>
<li>A Collibra instance</li>
</ul>
<h3 id="what-youll-build">What You’ll Build</h3>
<ul>
<li>Metadata of Snowflake, A Policy for this data, diagram that connects the data to its business context.</li>
</ul>
<!-- ------------------------ -->
<h2 id="metadata-configuration">Metadata Configuration</h2>
<p>Duration: 2</p>
<p>It is important to set the correct metadata for your Snowflake Guide. The metadata contains all the information required for listing and publishing your guide and includes the following:</p>
<ul>
<li>
<p><strong>summary</strong>:</p>
<ul>
<li>This is a guide on how to Catalog and use Snwoflake data using Collibra.</li>
</ul>
</li>
<li>
<p><strong>categories</strong>:</p>
<ul>
<li>data governance</li>
<li>data intelligence</li>
<li>data mesh</li>
<li>data privacy</li>
<li>data science</li>
</ul>
</li>
<li>
<p><strong>environments</strong>:</p>
<ul>
<li><code>web</code> . All work is done on the web, and there is no need to install anything locally on your computer.</li>
</ul>
</li>
<li>
<p><strong>status</strong>: Draft</p>
</li>
<li>
<p><strong>feedback link</strong>: https://github.com/Snowflake-Labs/sfguides/issues</p>
</li>
<li>
<p><strong>tags</strong>: Getting Started, Data Science, Twitter, Data Governance, Data Intelligence, Data Privacy, Data Mesh</p>
</li>
<li>
<p><strong>authors</strong>:</p>
<ul>
<li>Vasiliki Nikolopoulou, Collibra</li>
<li>Tomer Steinberg, Snowflake</li>
</ul>
</li>
</ul>
<hr>
<!-- ------------------------ -->
<h2 id="step-1-catalog-snowflake-into-collibra">STEP 1: Catalog Snowflake into Collibra</h2>
<p>Duration: 2</p>
<p>In this step we will import into Collibra the techincal metadata of the Snowflake database. We will use Collibra Edge, which is an Integration Hub residing within the customer firewall for safety. This integration hub retrieves the Snowflake metadata using native JDBC drivers.</p>
<p>Go to Collibra and click on Catalog to start the ingestion:</p>
<p><img src="assets/Catalog.jpg" alt="Catalog"></p>
<p>Click on the plus sign to choose the database:</p>
<p><img src="assets/edge1.jpg" alt="edge1"></p>
<p>Choose register through Edge and choose the Snowflake option (first option)</p>
<p><img src="assets/edge2.jpg" alt="edge2"></p>
<p>Go to the Snowflake Community and look for the D_CUSTOMER database:</p>
<p><img src="assets/edge3.jpg" alt="edge3"></p>
<!-- ------------------------ -->
<h2 id="step-2-auto-classification-and-business-semantics">STEP 2: Auto classification and business semantics</h2>
<p>Duration: 2</p>
<p>At this step we will relate the newly ingested technical metadata to its logical and business context.</p>
<p>After technical metadata ingestion, go to the Collibra Catalog and look for the new database:</p>
<p><img src="assets/catalogview.jpg" alt="catalogview"></p>
<p>Click on the table CUSTOMER and in the detailed view of this asset click on “Columns”:</p>
<p><img src="assets/columns.jpg" alt="columns"></p>
<p>In this page you will see information for each column, including sampling and profiling if the ingestion was done using this option. Next to each column there is the option to classify the data. You can start the automatic classification of the data by clicking on “Actions” and then clicking on “Classify”. Then some columns will get a data class with a percentage next to the data class specifying the probability Collibra thinks this is the right data class.</p>
<p>For example next to the column C_BIRTH_COUNTRY there is the data classification “Country”. We have accepted it as a data class appropriate for this column.</p>
<p><img src="assets/classification.jpg" alt="classification"></p>
<p>Every time you accept or reject the data class, then Collibra’s AI/ML engine will keep in memory the selections and when new data get ingested, these selections will be used to improve the probabilities for the data classes assigned.</p>
<p>You can click on the columns, for example the first one C_BIRTH_COUNTRY and then from the Actions menu choose the Guided Stewardship workflow that will guide us to assign the right data domain:</p>
<p><img src="assets/profiling.jpg" alt="profiling"></p>
<p>At this point the workflow starts and you simply have to decide which data domain this column belongs to. In this case it belongs to the Customer domain, so click on the customer radio button and click next.</p>
<p><img src="assets/guidedstewardship-step1.jpg" alt="guidedstewardship-step1"></p>
<p>In the next step we confirm that the data attribute is Country :</p>
<p><img src="assets/guidedstewardship-step2.jpg" alt="guidedstewardship-step2"></p>
<p>And then we can skip the next steps to complete the workflow.</p>
<p><img src="assets/guidedstewardship-end.jpg" alt="guidedstewardship-end"></p>
<p>Once this is completed then the user can see that the database is now linked to an ecosystem of logical and business context, as well as with data privacy rules and policies that were assigned to the logical attributes assigned to the columns. By clicking on the “Diagram” area you can see the full lineage, starting from the Customer table, linking it to the Customer data domain, which already belongs to the Marketing and Sales Department, which in turn is linked to Private and Restricted data policies and Data Privacy data categories.</p>
<p><img src="assets/diagram.jpg" alt="diagram"></p>
<p>One can expand further by clicking on the plus sign of the assets that have a plus sign, meaning that you can expand at will. For Example if you click on the plus sign of Customer logical entity :</p>
<p><img src="assets/diagram-expand.jpg" alt="diagram-expand"></p>
<p>Also you can expand on the Private Data policy and see that Country belongs to the Geographic Information Data Category and thus find what special data privacy context exists around some columns.</p>
<!-- ------------------------ -->
<h2 id="step-3-data-privacy-and-policy-enforcement">STEP 3: Data Privacy and Policy Enforcement</h2>
<p>Duration: 2</p>
<p>In this stage, we will specifically define the Data Privacy policies and rules that will be automatically enforced in Snowflake directly from within Collibra.</p>
<p>Please click on the Collibra Protect option after clicking the nine dots all the way to the top right of the Collibra User Interface:</p>
<p><img src="assets/Protect.jpg" alt="Protect"></p>
<p>This will take you to the Collibra Protect environment, then click on the Data Access Rules. And then click on Create a Data Access Rule button:</p>
<p><img src="assets/protectrule.jpg" alt="protectrule"></p>
<p>A form opens where you can create the new rule.</p>
<p>Type the name of the rule, its description. This is a rule about Marketing people. All people within Marketing will have access to this customer dataset, however we will enforce the hiding or masking of the Last Name column and we will only allow users to see customers from the country Belgium. We will choose the user group BE_MKT_ANALYST, in which will belong all marketing analysts in Belgium. You can fill in as follows:</p>
<p><img src="assets/rulecreation.jpg" alt="rulecreation"></p>
<p>At this point you can click on “Generate Preview” to see which columns will be viewed and which will be filtered and masked:</p>
<p><img src="assets/rulecreation1.jpg" alt="rulecreation1"></p>
<p><img src="assets/rulecreation2.jpg" alt="rulecreation2"></p>
<p>Click on Save Rule for the rule to be save. At this point the creation of this rule is sent to Collibra and the synchronization via API to the Snowflake environment is in Pending state. The synchronization happens automatically every 60 minutes.</p>
<p><img src="assets/creationrule3.jpg" alt="creationrule3"></p>
<p>If you need to expedite the synchronization of the new rules, you can trigger them via a POST command as follows from an API posting software:</p>
<p><img src="assets/post.jpg" alt="post"></p>
<p>This synchronization is triggered and within less than a minute we see that the rule is no longer in pending state but it is in effect:</p>
<p><img src="assets/rulecreation4.jpg" alt="rulecreation4"></p>
<p>We can simply check this if we login to Snowflake and go to D_CUSTOMER database, choose the PUBLIC schema and open the CUSTOMER table. Go to Preview and choose the BE_MKT_WH and also choose the role BE_MKT_ANALYST. Then you should be able to see the columns except for Last Name which is masked while all the rows are filtered for country Belgium.</p>
<!-- ------------------------ -->
<h2 id="step-4-data-consumption-and-access">STEP 4: Data Consumption and Access</h2>
<p>Duration: 2</p>
<p>In this chapter we will look into how a user can search and find trusted data to use and request access to the data while at the same time policies will be automatically enforced.</p>
<p>David, the marketing analyst from Sweden is looking for customer data that is trusted and contain email and first name and birthdate at the minimum.</p>
<p>In Collibra Data Marketplace the user is searching for customer data:</p>
<p><img src="assets/datamarketplace.jpg" alt="datamarketplace"></p>
<p>Filters the search by pressing the Data Sets tab and the Certified option in the filters to the left.</p>
<p><img src="assets/datamarketplace-filter.jpg" alt="datamarketplace-filter"></p>
<p>The second dataset is the one that seems proper since in the description it states that it contains names, birthdates and emails.</p>
<p><img src="assets/datamarketplaceviewasset.jpg" alt="datamarketplaceviewasset"></p>
<p>Clicking on the columns we confirm this is the right set:</p>
<p><img src="assets/datamarketplaceviewcolumns.jpg" alt="datamarketplaceviewcolumns"></p>
<p>Clicking on the Go to Asset Details we can discover more about this dataset. It belongs to the Customer Domain, we see the name of the Data Owner, the rating:</p>
<p><img src="assets/details.jpg" alt="details"></p>
<p>If the user clicks on the “Diagram” to the left it is possible to see the full lineage of the dataset, that includes the logical, the business, the data quality and data privacy context.</p>
<p>What we can see in this diagram, is the connection of the dataset to the columns and tables and systems it draws its data from. Then the connection of these technical metadata to the logical definitions and consequently to the business context. Also linked to the logical definitions we can see the data privacy rules.</p>
<p><img src="assets/diagrampolicies.jpg" alt="diagrampolicies"></p>
<p>Also you can click at the Data Protection tab all the way to the bottom left, and this will show the policies and restrictions associated with this dataset.</p>
<p><img src="assets/policyview.jpg" alt="policyview"></p>
<p>As you can see Collibra allows you to see the lineage of  a dataset in relation to its technical contents and in extension to its business and data privacy context. For example we can see that the columns that represent Last Name and Country each has a policy.</p>
<p>The user can add the dataset into the Data Basket by pressing the “Add to Data Basket” button:</p>
<p><img src="assets/basketbutton.jpg" alt="basketbutton"></p>
<p><img src="assets/basketmessage.jpg" alt="basketmessage"></p>
<p>This brings the dataset to the user’s personal Data Basket:</p>
<p><img src="assets/databasket.jpg" alt="databasket"></p>
<p>By clicking at the Data Basket icon we go to the area where we can start requesting the dataset(s).</p>
<p>The user can then choose the dataset and click on the “Checkout Data Basket” in order to start requesting access to the dataset.</p>
<p><img src="assets/requestaccess.jpg" alt="requestaccess"></p>
<p>By clicking Submit at the end of this form, a workflow starts which sends a notification to the dataset Data Owner, requesting access to the dataset:</p>
<p><img src="assets/tasktoapprove.jpg" alt="tasktoapprove"></p>
<p>The Data Owner will see the request and will evaluate if this user can get access to the dataset.</p>
<p>The Data Owner will then go to the dataset asset to check about policies and groups associated with this dataset. This will take us to the Collibra Protect rule that the Data Owner can check in detail:</p>
<p><img src="assets/protectrule1.jpg" alt="protectrule1"></p>
<p>In this case we see that this rule is about granting access to the dataset Customer master data to all people who work in the Marketing department, while there is default masking policy for the Last Name and the only customer rows shown are filtered by country, in this case Sweden.</p>
<p>Therefore the Data Owner understands that the user should be granted the SE_MKT_ANALYST role in Snowflake in order to get access to this dataset.</p>
<p>The Data Owner sends an approval notice to the requester, asking the requester to first accept the terms and conditions of accessing this dataset:</p>
<p><img src="assets/approve.jpg" alt="approve"></p>
<p>The requester will then receive the task to accept the terms and conditions in order for access to be granted. The user checks the “All of the above” radio button and clicks on the Accept Notice button to proceed.</p>
<p>At this point the Data Owner receives notification that the requester accepted the conditions and goes to Snowflake to grant to the requester the role “SE_MKT_ANALYST”.</p>
<p>Go to Snowflake in the area Users and Roles and Search for the user to which we are going to grant access. Then click on the three dots to the right of the user and choose the Grant Role option in order to grant the Role to the User.</p>
<p><img src="assets/snowflake-user.jpg" alt="snowflake-user"></p>
<p>At this point look for the Role in Collibra which gives access with enforced policies to a user, in this case the SE_MKT_ANALYST.</p>
<p><img src="assets/grant.jpg" alt="grant"></p>
<p>Now the user David will be able to login to Snowflake and access the table D_CUSTOMER with his role SE_MKT_ANALYST, and see the data with the enforced policies. First look for “Data”, then choose D_CUSTOMER, then choose the schema “Public” then choose the warehouse SE_MKT_WH, then Preview Data. As you can see the Last name is hidden:</p>
<p><img src="assets/lastnamehidden.jpg" alt="lastnamehidden"></p>
<p>And also the country is filtered to include customers from Sweden only:</p>
<p><img src="assets/filteredcountry.jpg" alt="filteredcountry"></p>
<!-- ------------------------ -->
<h2 id="conclusion">Conclusion</h2>
<p>Duration: 2</p>
<p>In this lab we learned how to catalog Snwoflake data, how to link this data to its business context, how to enforce privacy policies on it and how to search and access it.</p>

</body>
</html>
