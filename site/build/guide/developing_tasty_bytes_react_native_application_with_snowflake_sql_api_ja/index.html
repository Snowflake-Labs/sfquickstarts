
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Tasty Bytes - SQL APIによるReact Nativeデータアプリケーションの開発</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="developing_tasty_bytes_react_native_application_with_snowflake_sql_api_ja"
                  title="Tasty Bytes - SQL APIによるReact Nativeデータアプリケーションの開発"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/sfguides/issues">
    
      <google-codelab-step label="概要" duration="2">
        <p class="image-container"><img src="img/82e3f493a86ab504.png"></p>
<p>現代のデータドリブンな状況においては、アプリケーションの大半が高度にデータ集約的なものへと進化しています。しかし、特にユーザー数が増加し、データの量と複雑さが増している中では、優れたデータアプリケーションの開発が困難となる場合があります。Snowflakeは、多くのデータアプリケーションを支える原動力であり、ソフトウェアチームがエンジニアリングを迅速化し、運用上の複雑さに煩わされず、スケーラブルなアプリケーションを作成できるようにします。Snowflakeは、エンジニアリングの迅速化に重点を置いており、極めて高いパフォーマンスとスケーラビリティをアプリケーションに提供します。</p>
<p>Snowflakeは、データアプリの開発を促進するためにSQL APIを提供しています。SQL APIは、Snowflakeデータベース内でのデータのシームレスなアクセスと操作を可能にするRESTful APIです。SQL APIは、お使いのアプリケーションとSnowflakeの橋渡しの役割を果たし、プログラムによるデータの取得と更新を可能にします。</p>
<p>このチュートリアルでは、架空のキッチンカー会社であるTasty Bytesとキッチンカーの運転手が顧客からの注文を確認し、運転手が配達時に注文を完了処理できるアプリケーションを作成します。このチュートリアルでは、SQL APIを活用してキッチンカー運転手向けのReact Nativeアプリケーションを開発するプロセスについて説明します。</p>
<h2 is-upgraded>前提条件</h2>
<ul>
<li>Snowflakeでユーザー、データベース、ウェアハウスを作成するために必要な権限</li>
<li>コンピュータにソフトウェアをインストールして実行できること</li>
<li>gitの基本的な使用経験</li>
<li>SQLの中級知識</li>
<li>SnowflakeでSQLを実行するためのアクセス権</li>
</ul>
<h2 is-upgraded>学習する内容</h2>
<ul>
<li>SnowflakeとSQL APIを使用したデータアプリケーションの開発方法</li>
<li>キーペア認証を使用したSnowflakeでの認証</li>
<li>JavascriptでJWTトークンを生成する方法</li>
</ul>
<h2 is-upgraded>必要なもの</h2>
<ul>
<li><a href="https://github.com/" target="_blank">GitHub</a>のアカウント</li>
<li><a href="https://code.visualstudio.com/download" target="_blank">VSCode</a>のインストール、またはお好みのIDE</li>
<li><a href="https://nodejs.org/en/download/" target="_blank">NodeJS</a>のインストール</li>
</ul>
<h2 is-upgraded>構築するもの</h2>
<ul>
<li>SQL APIを使用するデータアプリケーション</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Snowflakeでのデータの設定" duration="3">
        <p>ここでは、Tasty Bytesの注文データを使用します。注文データを使用して、以下の機能を持つキッチンカーの運転手用のアプリケーションを構築します。</p>
<ul>
<li>キッチンカーの運転手がキュー内の注文を確認できる</li>
<li>運転手が、準備が整ったらSnowflakeで注文ステータスを更新することにより注文を完了処理できる</li>
<li>運転手が完了済みの注文を確認できる</li>
</ul>
<p>Snowflakeウェブインターフェイスである<a href="https://docs.snowflake.com/ja/user-guide/ui-snowsight.html#" target="_blank">Snowsight</a>を使用して、次のことを行います。</p>
<ul>
<li>Snowflakeオブジェクト（ウェアハウス、データベース、スキーマ）を作成する</li>
<li>S3からデータを取り込む</li>
<li>データを結合してビューを作成する</li>
</ul>
<h2 is-upgraded>オブジェクトの作成、データのロード、データの結合を行う</h2>
<p>ワークシートに移動し、右上の「+」をクリックして新しいワークシートを作成し、「SQLワークシート」を選択します。</p>
<p>ワークシートに以下のSQLを貼り付けて実行します。このSQLは、Snowflakeオブジェクト（ウェアハウス、データベース、スキーマ）を作成し、S3から未加工の注文データを取り込み、それをダウンストリームで使用するためにモデリングするためのものです。</p>
<pre><code language="language-sql" class="language-sql">-- use our accountadmin role
USE ROLE accountadmin;

-- create our database
CREATE OR REPLACE DATABASE frostbyte_tasty_bytes_app;

-- create raw, harmonized, and analytics schemas
-- raw zone for data ingestion
CREATE OR REPLACE SCHEMA frostbyte_tasty_bytes_app.raw;

-- harmonized zone for data processing
CREATE OR REPLACE SCHEMA frostbyte_tasty_bytes_app.harmonized;

-- analytics zone for data driven insights
CREATE OR REPLACE SCHEMA frostbyte_tasty_bytes_app.analytics;

-- create csv file format
CREATE OR REPLACE FILE FORMAT frostbyte_tasty_bytes_app.raw.csv_ff 
type = &#39;csv&#39;;

-- create an external stage pointing to S3
CREATE OR REPLACE STAGE frostbyte_tasty_bytes_app.raw.s3load
COMMENT = &#39;Quickstarts S3 Stage Connection&#39;
url = &#39;s3://sfquickstarts/frostbyte_tastybytes/app/app_orders/&#39;
file_format = frostbyte_tasty_bytes_app.raw.csv_ff;

-- create our raw.app_order_header table
CREATE OR REPLACE TABLE frostbyte_tasty_bytes_app.raw.app_order_header
(
  order_id NUMBER(19,0),
    month NUMBER(2,0),
    day NUMBER(2,0),
    hour NUMBER(2,0),
    minute NUMBER(2,0),
    second NUMBER(2,0),
    order_total NUMBER(19,3),
    order_tax_amount NUMBER(2,0),
    first_name VARCHAR,
    last_name VARCHAR,
    gender VARCHAR,
    order_status VARCHAR
);

-- create our raw.order_detail table
CREATE OR REPLACE TABLE frostbyte_tasty_bytes_app.raw.app_order_detail
(
  order_id NUMBER(19,0),
  order_detail_id NUMBER(19,0),
  menu_item_name VARCHAR,
  quantity NUMBER(2,0),
  unit_price NUMBER(19,3)
);

-- create our virtual warehouse
CREATE OR REPLACE WAREHOUSE tasty_app_wh AUTO_SUSPEND = 60;

-- use our TASTY_APP_WH virtual warehouse so we can load our data
USE WAREHOUSE tasty_app_wh;

-- ingest from S3 into the app_order_header table
COPY INTO frostbyte_tasty_bytes_app.raw.app_order_header
FROM @frostbyte_tasty_bytes_app.raw.s3load/app_order_header.csv.gz;

-- ingest from S3 into the app_order_detail table
COPY INTO frostbyte_tasty_bytes_app.raw.app_order_detail
FROM @frostbyte_tasty_bytes_app.raw.s3load/app_order_detail.csv.gz;

-- create our harmonized.data_app_orders_v view
CREATE OR REPLACE VIEW frostbyte_tasty_bytes_app.harmonized.data_app_orders_v
  AS
SELECT 
    oh.order_id,
    TIMESTAMP_NTZ_FROM_PARTS(YEAR(CURRENT_DATE()),oh.month,oh.day,oh.hour,oh.second, 0) AS order_ts,
    oh.order_total,
    oh.order_tax_amount,
    oh.first_name,
    oh.last_name,
    oh.gender,
    oh.order_status,
    od.order_detail_id,
    od.menu_item_name,
    od.quantity,
    od.unit_price
FROM frostbyte_tasty_bytes_app.raw.app_order_header oh
JOIN frostbyte_tasty_bytes_app.raw.app_order_detail od
ON oh.order_id = od.order_id;

-- promote our view to analytics
CREATE OR REPLACE VIEW frostbyte_tasty_bytes_app.analytics.data_app_orders_v
  AS
SELECT * FROM frostbyte_tasty_bytes_app.harmonized.data_app_orders_v;

-- view orders data
SELECT * FROM frostbyte_tasty_bytes_app.analytics.data_app_orders_v;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="アプリケーションのユーザーを作成する" duration="5">
        <p>堅牢なセキュリティ対策を確保するには、個人アカウントとは別に、アプリケーション専用のユーザーアカウントを設定することが不可欠です。この新しいアカウントは、Snowflakeのクエリに使用されます。セキュリティに関するベストプラクティスに従い、このアカウントではキーペア認証を採用し、アクセスをSnowflake環境内に制限します。</p>
<h2 is-upgraded>ステップ1：認証用の公開キーと非公開キーの生成</h2>
<p>以下のコマンドを実行して、非公開キーと公開キーを作成します。これらのキーは、Snowflakeでユーザーを認証するために必要となります。</p>
<pre><code language="language-Shell" class="language-Shell">$ cd ~/.ssh
$ openssl genrsa -out snowflake_app_key 4096
$ openssl rsa -in snowflake_app_key -pubout -out snowflake_app_key.pub
</code></pre>
<h2 is-upgraded>ステップ2：Snowflakeでユーザーとロールを作成し、この新しいロールにデータアクセスを許可する</h2>
<p>以下のSQLステートメントを実行してユーザーアカウントを作成し、アプリケーションに必要なデータへのアクセス権を付与します。</p>
<pre><code language="language-SQL" class="language-SQL">-- use our securityadmin role
USE ROLE securityadmin;

-- create the tasty_bytes_data_app_demo role
CREATE OR REPLACE ROLE tasty_bytes_data_app_demo;

-- use our securityadmin role
USE ROLE accountadmin;

-- grant privileges to our tasty_bytes_data_app_demo role
GRANT USAGE ON WAREHOUSE tasty_app_wh TO ROLE tasty_bytes_data_app_demo;
GRANT USAGE ON DATABASE frostbyte_tasty_bytes_app TO ROLE tasty_bytes_data_app_demo;
GRANT USAGE ON SCHEMA frostbyte_tasty_bytes_app.analytics TO ROLE tasty_bytes_data_app_demo;
GRANT USAGE ON SCHEMA frostbyte_tasty_bytes_app.harmonized TO ROLE tasty_bytes_data_app_demo;
GRANT USAGE ON SCHEMA frostbyte_tasty_bytes_app.raw TO ROLE tasty_bytes_data_app_demo;
GRANT SELECT ON ALL VIEWS IN SCHEMA frostbyte_tasty_bytes_app.analytics TO ROLE tasty_bytes_data_app_demo;
GRANT SELECT ON ALL VIEWS IN SCHEMA frostbyte_tasty_bytes_app.harmonized TO ROLE tasty_bytes_data_app_demo;
GRANT SELECT ON ALL TABLES IN SCHEMA frostbyte_tasty_bytes_app.analytics TO ROLE tasty_bytes_data_app_demo;
GRANT SELECT ON ALL TABLES IN SCHEMA frostbyte_tasty_bytes_app.harmonized TO ROLE tasty_bytes_data_app_demo;
GRANT SELECT ON ALL TABLES IN SCHEMA frostbyte_tasty_bytes_app.raw TO ROLE tasty_bytes_data_app_demo;
GRANT UPDATE ON TABLE frostbyte_tasty_bytes_app.raw.app_order_header TO ROLE tasty_bytes_data_app_demo;

-- use our useradmin role
USE ROLE useradmin;

-- Open the ~/.ssh/snowflake_app_key.pub file from Step 1 and copy the contents starting just after the PUBLIC KEY header, 
-- and stopping just before the PUBLIC KEY footer for INSERT_RSA_PUBLIC_KEY_HERE. Make sure to remove the additinal spaces. It should be a single line string.
CREATE OR REPLACE USER data_app_demo
RSA_PUBLIC_KEY=&#39;&lt;INSERT_RSA_PUBLIC_KEY_HERE&gt;&#39; 
DEFAULT_ROLE=frostbyte_tasty_bytes_app 
DEFAULT_WAREHOUSE=tasty_app_wh 
MUST_CHANGE_PASSWORD=false;

-- use our securityadmin role
USE ROLE securityadmin;
GRANT ROLE tasty_bytes_data_app_demo TO USER data_app_demo;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="SQL APIによるデータアプリケーション" duration="1">
        <p>皆さんが実行するアプリケーションはReact Nativeで記述されます。</p>
<h2 is-upgraded>ステップ1：ソースコードを取得する</h2>
<ol type="1">
<li><code>git clone https://github.com/sf-gh-sjasti/TastyBytesReactNativeAppWithSnowflake-SQL_API.git reactNativeApp</code>を使用してレポジトリをクローンします。</li>
<li>フォルダ<code>cd reactNativeApp</code>に移動します。</li>
<li><code>npm install</code>を実行して依存関係をインストールします。</li>
</ol>
<h2 is-upgraded>ステップ2：アプリケーションを設定する</h2>
<ol type="1">
<li>VS Codeまたはお好みのIDEで<code>reactNativeApp</code>フォルダを開きます。</li>
<li><code>.env</code>ファイルを開き、非公開キーで<code>PRIVATE_KEY</code>の値を更新します。ヘッダー（<code>-----BEGIN RSA PRIVATE KEY-----</code>）とフッター（<code>-----END RSA PRIVATE KEY-----</code>）を含め、<code>~/.ssh/snowflake_app_key</code>から非公開キー全体をコピー＆ペーストします。</li>
<li>米国西部に所在している場合は、<code>SNOWFLAKE_ACCOUNT_IDENTIFIER</code>を自分のSnowflakeアカウントに更新してください。（あるいは）米国西部以外の場所に所在している場合は、<code>SNOWFLAKE_ACCOUNT_IDENTIFIER</code>を「.」に更新してください。Snowflakeからsnowflake_accountの値を取得するには、Snowsightで<code>SELECT CURRENT_ACCOUNT()</code>を実行してください。Snowflakeからリージョン値を取得するには、Snowsightで<code>SELECT CURRENT_REGION()</code>を実行してください。SNOWFLAKE_ACCOUNT_IDENTIFIERとSNOWFLAKE_ACCOUNTは米国西部では同じとなります。</li>
<li><code>SNOWFLAKE_ACCOUNT</code>を自分のSnowflakeアカウントに更新します。</li>
<li><code>PUBLIC_KEY_FINGERPRINT</code>を自分のユーザー公開キーのフィンガープリントに更新します。公開キーのフィンガープリントを取得するには、SnowsightでSQL、<code>DESCRIBE USER data_app_demo</code> を実行し、RSA_PUBLIC_KEY_FPプロパティ値を取得します。</li>
</ol>
<h2 is-upgraded>ステップ3：ソースコードをレビューする</h2>
<p>ここでは、SQL APIを使用し、Snowflakeでキーペア認証を使用して認証を行います。JWTトークンの生成方法については、<code>Tokens.js</code>を参照してください。<code>Orders.js</code>には、「注文」画面をレンダリングするためのソースコードがあります。このファイルには、SQL API呼び出しの開始方法と必要なヘッダーに関する情報も記載されています。<code>OrderDetails.js</code>には、「注文の詳細」画面をレンダリングするためのソースコードがあります。</p>
<h2 is-upgraded>ステップ4：アプリケーションをテストする</h2>
<ol type="1">
<li><code>npx expo start --clear</code>を実行し、<code>w</code>キーを押してWebブラウザでアプリを実行します。</li>
<li>この操作により、Webブラウザでアプリが起動します。</li>
<li>起動すると、「キュー内の注文」画面が表示されます。</li>
</ol>
<p><img src="img/c928200bb658c55a.png"> 4. 注文の詳細を表示するには、「View Order（注文を表示）」ボタンをクリックします。 <img src="img/c9419f92b09eeeca.png"> 5. 注文を完了処理するには、「ORDER READY（注文準備完了）」ボタンをクリックします。この操作により、この注文の注文ステータスの値が「完了」に更新され、「キュー内の注文」画面に戻ります。 6. ここで、「注文履歴」タブをクリックすると、完了した注文を確認できます。 <img src="img/8a3bc29cdf337304.png"> ## クリーンアップ </p>
<p>Snowsightワークシートに移動し、右上の「+」をクリックして新しいワークシートを作成し、「SQLワークシート」を選択します。次のSQLをワークシートに貼り付けて実行し、クイックスタートで作成したSnowflakeオブジェクトを削除します。</p>
<pre><code language="language-sql" class="language-sql">USE ROLE accountadmin;
DROP DATABASE frostbyte_tasty_bytes_app;
DROP WAREHOUSE tasty_app_wh;

USE ROLE securityadmin;
DROP USER data_app_demo;
DROP ROLE tasty_bytes_data_app_demo;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="まとめ" duration="1">
        <h2 is-upgraded>まとめ</h2>
<p>**お疲れ様でした。**Tasty Bytes - SQL APIによるReact Nativeデータアプリケーションの開発クイックスタートを無事完了しました。</p>
<p>これにより、次のことを学習しました。</p>
<ul>
<li>SnowflakeとSQL APIを使用したデータアプリケーションの開発</li>
<li>キーペア認証を使用したSnowflakeでの認証</li>
<li>JavascriptでのJWTトークンの生成</li>
</ul>
<h2 is-upgraded>次のステップ</h2>
<p>引き続きSnowflakeデータクラウドについて学習するには、以下のリンクから利用可能なTasty Bytes - クイックスタートをご覧ください。</p>
<ul>
<li><h2 is-upgraded><a href="https://quickstarts.snowflake.com/guide/tasty_bytes_introduction_ja/index.html" target="_blank">Powered by Tasty Bytes - クイックスタート目次</a></h2>
</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
