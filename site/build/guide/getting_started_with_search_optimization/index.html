
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Getting started with Search Optimization</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="getting_started_with_search_optimization"
                  title="Getting started with Search Optimization"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/sfguides/issues">
    
      <google-codelab-step label="Overview" duration="10">
        <p>Are you looking to significantly improve the performance of point lookup queries and certain analytical queries that require fast access to records? Search Optimization Service will help you achieve exactly that.</p>
<p>We create optimized search access paths for the columns in your tables. We take advantage of those optimized paths in addition to other processing enhancements to reduce the number of micro partitions scanned and hence speed up the queries.</p>
<p>For example, in the picture below, we have a query that is trying to find all rows where the name is Martin in a table. If Search Optimization is enabled, it helps identify <strong><em>the micro partitions that don&#39;t contain â€˜Martin&#39; in the name column</em></strong> and reduces the number of partitions to be scanned. In this particular example, it reduces the number of partitions to be scanned from 15 to 1. <img alt="SO Working" src="img/d18f1b889f54ef5a.png"></p>
<h2 is-upgraded>Prerequisites</h2>
<p>A basic knowledge of how to run and monitor queries in the Snowflake Web UI.</p>
<h2 class="checklist" is-upgraded>What you&#39;ll learn</h2>
<ul class="checklist">
<li>How to acquire a suitable dataset from Snowflake Marketplace</li>
<li>How to enable Search Optimization</li>
<li>What is the performance impact of enabling Search Optimization on different queries</li>
</ul>
<h2 is-upgraded>What You&#39;ll Need</h2>
<ul>
<li>A supported <a href="https://docs.snowflake.com/en/user-guide/setup.html" target="_blank">browser</a></li>
<li>A Snowflake account with the Enterprise Edition <ul>
<li>Sign-up using <a href="https://signup.snowflake.com/?utm_cta=quickstarts_" target="_blank">Snowflake Trial</a><strong><em>OR</em></strong></li>
<li>Get access to an existing Snowflake Enterprise Edition account with the <code>ACCOUNTADMIN</code> role or the <code>IMPORT SHARE</code> privilege</li>
</ul>
</li>
</ul>
<h2 is-upgraded>What You&#39;ll Build</h2>
<p>Performant queries that explore the data from [LLM Training] (https://app.snowflake.com/marketplace/listing/GZTSZ290BUX1X/cybersyn-llm-training) dataset by [Cybersyn] (https://docs.cybersyn.com/intro/). Cybersyn is a Data-as-a-Service (DaaS) company that is native to Snowflake.</p>
<p>Negative: The Marketplace data used in this guide changes from time-to-time, and your query results may be slightly different than indicated in this guide. Additionally, the Snowflake UI changes periodically as well, and instructions/screenshots may be out of date.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Setup Snowflake Account and Virtual Warehouse" duration="5">
        <p>The first step in the guide is to set up or log into Snowflake and set up a virtual warehouse if necessary.</p>
<h2 is-upgraded>Access Snowflake&#39;s Web UI</h2>
<p><a href="https://app.snowflake.com" target="_blank">app.snowflake.com</a></p>
<p><strong>If this is the first time you are logging into the Snowflake UI</strong>, you will be prompted to enter your account name or account URL that you were given when you acquired a trial. The account URL contains your account name and potentially the region. Click <code>Sign-in</code> and you will be prompted for your user name and password.</p>
<p><strong>If this is not the first time you are logging into the Snowflake UI</strong>, you should see a <code>Select an account to sign into</code> prompt and a button for your account name listed below it. Click the account you wish to access and you will be prompted for your user name and password (or another authentication mechanism).</p>
<h2 is-upgraded>Switch to the appropriate role</h2>
<p>The Snowflake web interface has a lot to offer, but for now, switch your current role from the default <code>SYSADMIN</code> to <code>ACCOUNTADMIN</code>.</p>
<p class="image-container"><img alt="worksheet-image" src="img/b9575209bfee61ca.png"></p>
<p>This will allow you to create shared databases from Snowflake Marketplace listings. If you don&#39;t have the <code>ACCOUNTADMIN</code> role, switch to a role with <code>IMPORT SHARE</code> privileges instead.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create a Virtual Warehouse (if needed)" duration="2">
        <p><strong><em>If you don&#39;t already have access to a Virtual Warehouse to run queries</em></strong>, you will need to create one.</p>
<ul>
<li>Navigate to the Compute &gt; Warehouses screen using the menu on the left side of the window</li>
<li>Click the big blue + Warehouse button in the upper right of the window</li>
<li>Create a Small Warehouse as shown in the screen below</li>
</ul>
<p class="image-container"><img alt="new-warehouse" src="img/255158dd804faa66.png"></p>
<p>Be sure to change the <code>Suspend After (min) field</code> to 1 min to avoid wasting compute credits.</p>
<p><strong><em>If you already have access to a Virtual Warehouse to run queries</em></strong>, make sure to scale it up or down to <code>Small</code> Warehouse for this guide.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Acquiring Data from Snowflake Marketplace" duration="2">
        <p>The next step is to acquire data that has all data types supported by Search Optimization. The best place to acquire this data is the Snowflake Marketplace.</p>
<ul>
<li>Navigate to the <code>Marketplace</code> screen using the menu on the left side of the window</li>
<li>Search for <code>Cybersyn</code> in the search bar</li>
<li>Find and click the <code>LLM Training</code> tile</li>
</ul>
<p class="image-container"><img alt="LLM Training" src="img/d431d660da4da6ab.png"></p>
<ul>
<li>Once in the listing, click the big blue Get Data button</li>
</ul>
<p>On the <code>Get Data</code> screen, you may be prompted to complete your user profile if you have not done so before. Enter your name and email address into the profile screen and click the blue <code>Save</code> button. You will be returned to the <code>Get Data</code> screen.</p>
<p>Congratulations! You have just created a shared database named <code>LLM_TRAINING</code> from a listing on the Snowflake Marketplace. Click the big blue <code>Query Data</code> button and advance to the next step in the guide.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Data Setup" duration="10">
        <p>The prior section opened a worksheet editor in the new Snowflake UI with a few pre-populated queries that came from the sample queries defined in the Marketplace listing. You are not going to run any of these queries in this guide, but you are welcome to run them later.</p>
<h2 is-upgraded>Understanding the data</h2>
<p>You are going to first copy over two of the tables from <code>LLM_TRAINING</code> (the database that you just imported) into a new database (we will call it <code>LLM_TRAINING_SO</code>).</p>
<p>This is necessary as</p>
<ul>
<li>You wouldn&#39;t have the privileges to set up Search Optimization on the shared <code>LLM_TRAINING</code> database</li>
<li>It will allow you to run the same query on both search optimized (in <code>LLM_TRAINING_SO</code> database) and non search optimized tables (in <code>LLM_TRAINING</code> database) to compare the performance of Search Optimization.</li>
<li>Optionally, you can also create another database to store the tables without Search Optimization to compare performance and check the partition access/pruning details, as querying on the shared data will not show this information.</li>
</ul>
<p>The table we will use is <code>OPENALEX_WORKS_INDEX</code>, which has data from OpenAlex, a bibliographic catalogue of scientific papers, authors, and institutions accessible in open access mode. It has <strong><em>~260 million rows</em></strong>.</p>
<h2 is-upgraded>Copy the required tables into a new database</h2>
<p>Now let&#39;s copy over the above table or all 27 tables into a new database before we enable Search Optimization on OPENALEX_WORKS_INDEX.</p>
<p>Before we run the queries to do so, let&#39;s create a new worksheet named <code>Search Optimization Guide</code> by clicking the <code>+ icon</code> on the left navigation bar. Throughout this guide, we will run  the queries on the search optimized tables in the <code>Search Optimization Guide</code> worksheet.</p>
<p>Run the query below in the <code>Search Optimization Guide</code> worksheet:</p>
<pre><code>//Note: Use appropriate role having required privileges as mentioned 
//https://docs.snowflake.com/en/user-guide/search-optimization/enabling#required-access-control-privileges
USE ROLE accountadmin;

//Note: Substitute warehouse name my_wh with your warehouse name if different
USE WAREHOUSE my_wh;

//Note: Substitute database name so_analysis with your choice of database name(if required)
CREATE OR REPLACE DATABASE LLM_TRAINING_SO;

USE DATABASE LLM_TRAINING_SO;

SHOW SCHEMAS;

//Note: Create Schema name of your choice if you do not want to use PUBLIC schema
USE SCHEMA public;
CREATE SCHEMA CYBERSYN;
USE SCHEMA CYBERSYN;

//Note: Substitute my_wh with your warehouse name if different and use warehouse size of your choice
ALTER WAREHOUSE my_wh set warehouse_size=&#39;4x-large&#39;;

//This query time will depend on the warehouse size.
CREATE OR REPLACE TABLE OPENALEX_WORKS_INDEX AS SELECT * FROM LLM_TRAINING.CYBERSYN.OPENALEX_WORKS_INDEX; 
</code></pre>
<pre><code>//Note: Check the table details
DESCRIBE TABLE OPENALEX_WORKS_INDEX;

SHOW TABLES LIKE &#39;OPENALEX_WORKS_INDEX&#39; IN SCHEMA LLM_TRAINING_SO.CYBERSYN;

//Note: Check the table details by looking at the table DDL.
SELECT GET_DDL(&#39;table&#39;,&#39;LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX&#39;);

//Note: Check the data (Optional)
SELECT * FROM LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX LIMIT 100;
</code></pre>
<p>Before enabling Search Optimization on the table, it is recommended to execute queries on the table <code>OPENALEX_WORKS_INDEX</code> with filter predicates on the columns on which you wish to enable Search Optimization. This will show you the benefits of using Search Optimization.</p>
<pre><code>// Note: Optional to execute the queries before enabling Search Optimization on the table

ALTER SESSION SET use_cached_result = false; -- to clear cached data

ALTER WAREHOUSE my_wh SET warehouse_size = MEDIUM;

ALTER WAREHOUSE my_wh SUSPEND; -- to clear data cached at the warehouse level

ALTER WAREHOUSE my_wh RESUME;

ALTER WAREHOUSE my_wh SET warehouse_size= &#39;X-SMALL&#39;;

// Note: This query will take ~2 minutes 
SELECT *  from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX where mag_work_id = 2240388798; 

// Note: This query will take ~2.5 minutes 
SELECT *  from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX where work_title ilike &#39;Cross-domain applications of multimodal human-computer interfaces&#39;; 

// Note: This query will take ~3 minutes 
SELECT * from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX  where WORK_PRIMARY_LOCATION:source:display_name ilike &#39;Eco-forum&#39;; 

// Note: This query will take ~4 minutes 
SELECT * from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX  where WORK_PRIMARY_LOCATION:source:issn_l = &#39;2615-6946&#39;; 
</code></pre>
<p>Check Search Optimization estimated credit consumption before enabling Search Optimization using the <a href="https://docs.snowflake.com/en/sql-reference/functions/system_estimate_search_optimization_costs" target="_blank">cost estimation function</a>.</p>
<pre><code>//Note: Optional but recommended step

SELECT SYSTEM$ESTIMATE_SEARCH_OPTIMIZATION_COSTS(&#39;LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX&#39;,
                                               &#39;EQUALITY(MAG_WORK_ID),EQUALITY(WORK_PRIMARY_LOCATION:source.display_name),
                                               SUBSTRING(WORK_TITLE),SUBSTRING(WORK_PRIMARY_LOCATION:source.issn_l)&#39;)
AS estimate_for_columns_without_search_optimization;
</code></pre>
<p>The output of the cost estimation function will give you an idea of the credit consumption of building and maintaining the search optimization index.</p>
<h2 is-upgraded>Enable Search Optimization</h2>
<p>Now, let&#39;s enable Search Optimization for the <code>OPENALEX_WORKS_INDEX</code> in the newly created <code>LLM_TRAINING_SO</code> Database (<code>Search Optimization Guide</code> Worksheet). Depending on the queries we want to accelerate, we can either enable search optimization for the whole table or for a few columns.</p>
<p>For this guide, let&#39;s selectively enable Search optimization for a few columns:</p>
<pre><code>// Defining Search Optimization on NUMBER fields For Equality
ALTER TABLE LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX ADD SEARCH OPTIMIZATION ON EQUALITY(MAG_WORK_ID);

// Defining Search Optimization on VARCHAR fields optimized for Wildcard search
ALTER TABLE LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX ADD SEARCH OPTIMIZATION ON SUBSTRING(WORK_TITLE);

// Defining Search Optimization on VARIANT field For Equality
ALTER TABLE LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX ADD SEARCH OPTIMIZATION ON SUBSTRING(WORK_PRIMARY_LOCATION:source.display_name);

// Defining Search Optimization on VARIANT field For Wildcard search
ALTER TABLE LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX ADD SEARCH OPTIMIZATION ON EQUALITY(WORK_PRIMARY_LOCATION:source.issn_l);

SHOW TABLES LIKE &#39;OPENALEX_WORKS_INDEX&#39; IN SCHEMA LLM_TRAINING_SO.CYBERSYN;
</code></pre>
<h2 is-upgraded>Ensure Search Optimization first time indexing is complete</h2>
<p>Now, let&#39;s verify that Search Optimization is enabled and the backend process has finished indexing our data. It will take about 2 minutes for that to happen as the optimized search access paths are being built for these columns by Snowflake.</p>
<p>Run the below query against the newly created database (<code>LLM_TRAINING_SO</code>)</p>
<pre><code>DESCRIBE SEARCH OPTIMIZATION ON LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX;
</code></pre>
<p>It would return a result like below:</p>
<p class="image-container"><img alt="SOActive" src="img/b98804bf2bc453b8.png"></p>
<p>Make sure that all the rows have the active column set to true before proceeding further in this guide.</p>
<p>Now you are all set up to run some queries and dive deep into Search Optimization.</p>
<p><strong><em>NOTE:</em></strong> Please note that the results, query time, partitions or bytes scanned might differ when you run the queries in comparison to the values noted below as the data gets refreshed monthly in the above two tables.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Equality and Wildcard Search" duration="10">
        <p>Now let&#39;s build some queries and observe how Search Optimization helps optimize them.</p>
<p>To start off, we have already enabled Search Optimization on the <code>MAG_WORK_ID</code> and <code>WORK_TITLE</code> fields for equality and substring predicates respectively in the previous section.</p>
<p class="image-container"><img alt="SOEqualitySearch" src="img/b98804bf2bc453b8.png"></p>
<p><strong><em>NOTE:<br></em></strong> If you wish to run the queries below on both databases (<code>LLM_TRAINING</code> and <code>LLM_TRAINING_SO</code>) to evaluate performance impact, please make sure to run the commands below before you switch from one database to another. This will ensure that no cached results (hot or warm) are used.<br><br> ALTER SESSION SET USE_CACHED_RESULT = false;<br> ALTER WAREHOUSE my_wh SUSPEND;</p>
<p>Now, run the same queries that you executed earlier when the Search Optimization was not enabled on the table. The query would look like below and is for the EQUALITY search on the column <code>MAG_WORK_ID</code> :</p>
<pre><code>SELECT *  
  FROM LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX 
  WHERE 
    mag_work_id = 2240388798;
</code></pre>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Without search optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>It takes 1 minute 43 seconds to run the query on the table without search optimization. The other interesting aspect is that almost all partitions 15947 out of 15953 need to be scanned. Also, you will note that ~20GB of data is scanned.</p>
</td><td colspan="1" rowspan="1"><p>On the other hand, the query takes 2.2 seconds on the search optimized table. You will notice that only 1 partition of the total 15953 partitions was scanned. In addition, only ~91MB of the data needs to be scanned.</p>
</td></tr>
</table>
<p class="image-container"><img alt="STATISITCS_LLM_1" src="img/253b303bace698d7.png"></p>
<p><em>Looking at the numbers side by side, we know that Search Optimization has definitely improved the query performance.</em></p>
<table>
<tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"><p><strong>Without Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Performance Impact</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Query run time</strong></p>
</td><td colspan="1" rowspan="1"><p>1 minute 43 seconds</p>
</td><td colspan="1" rowspan="1"><p>2.2 seconds</p>
</td><td colspan="1" rowspan="1"><p><strong>97.86% improvement</strong> in query speed</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Percentage of partitions scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>99.96%</p>
</td><td colspan="1" rowspan="1"><p>0.0001%</p>
</td><td colspan="1" rowspan="1"><p><strong>99.9% less partitions</strong> scanned</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Bytes scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>20.20GB</p>
</td><td colspan="1" rowspan="1"><p>91.88MB</p>
</td><td colspan="1" rowspan="1"><p><strong>99.9% less data</strong> scanned</p>
</td></tr>
</table>
<p>Let&#39;s look at another example with the SUBSTR search on the column <code>WORK_TITLE</code>.</p>
<pre><code>SELECT *  
  FROM LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX 
  WHERE 
    work_title ilike &#39;Cross-domain applications of multimodal human-computer interfaces&#39;; 
</code></pre>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Without search optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>The query runs for ~2.5 minutes and ALL partitions are scanned. Also, 31.70GB of data is scanned. See the picture below for full details.</p>
</td><td colspan="1" rowspan="1"><p>On the other hand, the query runs in 5 seconds on the Search Optimized table. You&#39;ll also notice that only 182 partitions of the total 15953 partitions are scanned. In addition, 1.07GB of the data was scanned. See the picture below for full details.</p>
</td></tr>
</table>
<p class="image-container"><img alt="STATISITCS_LLM_2" src="img/253b303bace698d7.png"></p>
<p><em>As you can see from the </em></p>
<p><strong><em>Performance Impact</em></strong></p>
<p><em> column above, using Search Optimization allows us to make significant improvements in query performance.</em></p>
<table>
<tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"><p><strong>Without Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Performance Impact</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Query run time</strong></p>
</td><td colspan="1" rowspan="1"><p>2 minute 25s</p>
</td><td colspan="1" rowspan="1"><p>5 seconds</p>
</td><td colspan="1" rowspan="1"><p><strong>97% improvement</strong> in query speed</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Percentage of partitions scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>100%</p>
</td><td colspan="1" rowspan="1"><p>1.2%</p>
</td><td colspan="1" rowspan="1"><p><strong>98.8% less partitions</strong> scanned</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Bytes scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>31.70GB</p>
</td><td colspan="1" rowspan="1"><p>1.07GB</p>
</td><td colspan="1" rowspan="1"><p><strong>96.62% less data</strong> scanned</p>
</td></tr>
</table>
<p>Want to learn more? You can refer to our external documentations for benefitting from Search Optimization for queries with <a href="https://docs.snowflake.com/en/user-guide/search-optimization-service.html#equality-or-in-predicates" target="_blank"> Equality Predicates</a> and <a href="https://docs.snowflake.com/en/user-guide/search-optimization-service" target="_blank">Wildcards</a>.html#substrings-and-regular-expressions)</p>


      </google-codelab-step>
    
      <google-codelab-step label="Searching in Variant data" duration="5">
        <p>In this section, let&#39;s search in the variant data and analyze how Search Optimization helps in these cases.</p>
<p><strong><em>NOTE:<br></em></strong> If you wish to run the queries below on both databases (<code>LLM_TRAINING</code> and <code>LLM_TRAINING_SO</code>) to evaluate performance impact, please make sure to run the commands below before you switch from one database to another. This will ensure that no cached results (hot or warm) are used.<br><br> ALTER SESSION SET USE_CACHED_RESULT = false;<br> ALTER WAREHOUSE my_wh SUSPEND; ALTER WAREHOUSE my_wh RESUME;</p>
<p>To start, we have already enabled Search Optimization on the <code>WORK_PRIMARY_LOCATION</code> field, which is an unstructured JSON field. We also enabled SUBTR and EQUALITY search on different columns of the JSON data.</p>
<p class="image-container"><img alt="VariantSOActive" src="img/b9e3b9dfdd515b77.png"></p>
<p>Now, run the same queries that you executed earlier when the Search Optimization was not enabled on the table. The query would look like below and is for the EQUALITY search on the variant column <code>WORK_PRIMARY_LOCATION:source:issn_l</code>:</p>
<pre><code>select * 
  from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX  
  where 
    WORK_PRIMARY_LOCATION:source:issn_l = &#39;2615-6946&#39;;
</code></pre>
<p>The above query returns <strong><em>1 row out of 260 million rows</em></strong>.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Without search optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>The query runs for 4m14s on the table without search optimization. You will also see that ALL partitions need to be scanned. In addition, 105.76GB of data was scanned.</p>
</td><td colspan="1" rowspan="1"><p>On the other hand, it takes 1.7 seconds to run the same query on the search optimized table. You will also notice that only 1 partition of the total 15953 partitions is scanned. In addition, only 34.80MB of the data was scanned.</p>
</td></tr>
</table>
<p class="image-container"><img alt="STATISITCS_LLM_3" src="img/b735d0fb1d19c018.png"></p>
<p><em>From the </em></p>
<p><strong><em>Performance Impact</em></strong></p>
<p><em> column below, we see that using Search Optimization allows us to make significant improvements in query performance</em></p>
<table>
<tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"><p><strong>Without Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Performance Impact</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Query run time</strong></p>
</td><td colspan="1" rowspan="1"><p>4 minute 14 seconds</p>
</td><td colspan="1" rowspan="1"><p>1.7 seconds</p>
</td><td colspan="1" rowspan="1"><p><strong>99.9% improvement</strong> in query speed</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Percentage of partitions scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>100%</p>
</td><td colspan="1" rowspan="1"><p>0.0001%</p>
</td><td colspan="1" rowspan="1"><p><strong>99.9% less partitions</strong> scanned</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Bytes scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>105.76GB</p>
</td><td colspan="1" rowspan="1"><p>34.80MB</p>
</td><td colspan="1" rowspan="1"><p><strong>99.9% less data</strong> scanned</p>
</td></tr>
</table>
<p>Another example, for EQUALITY search on the variant column <code>WORK_PRIMARY_LOCATION:source:issn_l</code>:</p>
<pre><code>select * 
  from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX  
  where 
    WORK_PRIMARY_LOCATION:source:display_name ilike &#39;Eco-forum&#39;; 
</code></pre>
<p>The above query returns <strong><em>416 rows out of 260 million rows</em></strong>.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Without search optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>The query runs for 3m2s on the table without search optimization. You will also see that ALL partitions need to be scanned. In addition, 28.66GB of data was scanned.</p>
</td><td colspan="1" rowspan="1"><p>On the other hand, it takes 12 seconds to run the same query on the search optimized table. You will also notice that only 412 partitions of the total 15953 partitions are scanned. In addition, 6.07GB of the data was scanned.</p>
</td></tr>
</table>
<p class="image-container"><img alt="STATISITCS_LLM_4" src="img/deffd02089bae743.png"></p>
<p><em>From the </em></p>
<p><strong><em>Performance Impact</em></strong></p>
<p><em> column below, we see that using Search Optimization allows us to make significant improvements in query performance</em></p>
<table>
<tr><td colspan="1" rowspan="1"></td><td colspan="1" rowspan="1"><p><strong>Without Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>With Search Optimization</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Performance Impact</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Query run time</strong></p>
</td><td colspan="1" rowspan="1"><p>3 minute 2 seconds</p>
</td><td colspan="1" rowspan="1"><p>12 seconds</p>
</td><td colspan="1" rowspan="1"><p><strong>93.4% improvement</strong> in query speed</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Percentage of partitions scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>100%</p>
</td><td colspan="1" rowspan="1"><p>2.6%</p>
</td><td colspan="1" rowspan="1"><p><strong>97.4% less partitions</strong> scanned</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Bytes scanned</strong></p>
</td><td colspan="1" rowspan="1"><p>28.66GB</p>
</td><td colspan="1" rowspan="1"><p>6.07MB</p>
</td><td colspan="1" rowspan="1"><p><strong>78.82% less data</strong> scanned</p>
</td></tr>
</table>
<p>Want to learn more? You can refer to our external documentations for <a href="https://docs.snowflake.com/en/user-guide/search-optismization-service.html#fields-in-variant-columns" target="_blank">benefitting from Search Optimization for queries on Variant Data</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Queries that are not benefitting from Search Optimization" duration="0">
        <p>Not all queries benefit from Search Optimization. One such example is the following query to get all entries that have description with the words <code>Reactions Weekly</code> and page in that order. The query would look like:</p>
<pre><code>select * 
  from LLM_TRAINING_SO.CYBERSYN.OPENALEX_WORKS_INDEX  
  where 
    WORK_PRIMARY_LOCATION:source:display_name ilike &#39;Reactions Weekly&#39;; 
</code></pre>
<p>The following query returns <strong>~256K rows</strong>. As shown in the snapshot below, <strong>only 8 out of the 15953 partitions is skipped</strong> when you run the query on the search optimized <strong>OPENALEX_WORKS_INDEX</strong> table in our newly created <strong>LLM_TRAINING_SO</strong> database .</p>
<p class="image-container"><img alt="SO_Not_Applicable" src="img/97cf5a16fdd9950.png"></p>
<p><strong>Such queries aren&#39;t benefitted from Search Optimization as the number of partitions that can be skipped by Search Optimization Service are very minimal.</strong></p>


      </google-codelab-step>
    
      <google-codelab-step label="Conclusion" duration="1">
        <p>In this guide, we have covered how to acquire a shared database from Snowflake Marketplace, how to enable Search Optimization on specific columns and analyze the performance improvements in queries with Search Optimization enabled.</p>
<p>You are now ready to explore the larger world of Snowflake <a href="https://docs.snowflake.com/en/user-guide/search-optimization-service.html" target="_blank">Search Optimizaitn Service</a></p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
