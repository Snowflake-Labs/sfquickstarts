
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Insights to Action With Snowflake and ServiceNow</title>

  
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5Q8R2G');</script>
  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08H27EW14N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-08H27EW14N');
</script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5Q8R2G"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <google-codelab-analytics gaid="UA-41491190-9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="insights-to-action-with-snowflake-and-servicenow"
                  title="Insights to Action With Snowflake and ServiceNow"
                  environment="web"
                  feedback-link="https://github.com/Snowflake-Labs/sfguides/issues">
    
      <google-codelab-step label="Overview" duration="2">
        <p>ServiceNow Workflows automate business processes by defining a series of tasks, approvals, and conditions within the platform. They help streamline IT service management (ITSM), HR, customer service, and other enterprise functions by reducing manual effort and enforcing consistency. Workflows can be triggered manually or automatically based on certain events such as insights generated in  your data and AI platform.</p>
<p>In this guide you will learn how to automatically trigger ServiceNow Workflow based on insights generated in Snowflake.</p>
<p>Here is a high level pictorial representation of the architecture showing interaction between Snowflake and ServiceNow. <img alt="High Level Architecture" src="img/6f9a855fbd6c4835.png"></p>
<h2 is-upgraded>Prerequisites</h2>
<p>Familiarity with SQL and REST API</p>
<h2 class="checklist" is-upgraded>What You&#39;ll Learn</h2>
<ul class="checklist">
<li>How to create a ServiceNow workflow with a REST inbound trigger</li>
<li>How to securely connect to the ServiceNow Instance from Snowflake</li>
<li>How to use Snowflake alerts to flag an event</li>
<li>How to start the ServiceNow workflow from Snowflake</li>
</ul>
<h2 is-upgraded>What You&#39;ll Need</h2>
<ul>
<li>A <a href="https://signup.snowflake.com/?utm_cta=quickstarts_" target="_blank">Snowflake</a> Account</li>
<li>A <a href="https://developer.servicenow.com/dev.do" target="_blank">ServiceNow</a> Personal Developer Instance.</li>
<li>To create a REST API trigger, you&#39;ll need to enable the Integration Hub Enterprise Pack Plugin as outlined in this <a href="https://developer.servicenow.com/dev.do#!/learn/learning-plans/washingtondc/servicenow_application_developer/app_store_learnv2_rest_washingtondc_exercise_activate_integrationhub" target="_blank">link</a></li>
</ul>
<h2 is-upgraded>What You&#39;ll Build</h2>
<p>A solution to automatically trigger workflows in ServiceNow based on insights generated in Snowflake. The solution supports a <strong>push model</strong>, eliminating the need for continuous polling. On the ServiceNow side, you can use the data from Snowflake to perform pre-checks and enable intelligent routing of requests.</p>
<h2 is-upgraded>How can you use the solution</h2>
<p>Some of the use cases where this solution can drive real business value across departments:</p>
<p><strong>Human Resources (HR)</strong></p>
<ul>
<li>Scenario: Onboarding Readiness Check</li>
<li>Insight in Snowflake: A scheduled Snowflake job finds that access provisioning is incomplete for new hires starting next week.</li>
<li>Trigger: Starts a ServiceNow onboarding workflow to notify HR, IT, and facilities.</li>
<li>Benefit: Prevents first-day delays and ensures smooth onboarding.</li>
</ul>
<p><strong>IT Operations / Infrastructure</strong></p>
<ul>
<li>Scenario: Predictive Maintenance for Devices</li>
<li>Insight in Snowflake: IoT sensor data analysis predicts a cooling system will likely fail within 3 days.</li>
<li>Trigger: Creates a maintenance request in ServiceNow and assigns to the facilities team.</li>
<li>Benefit: Enables proactive repairs, reduces downtime and costs.</li>
</ul>
<p><strong>Supply Chain / Inventory</strong></p>
<ul>
<li>Scenario: Inventory Shortage Alert</li>
<li>Insight in Snowflake: Real-time data shows a critical product is below the safety stock threshold.</li>
<li>Trigger: Triggers a ServiceNow procurement workflow to reorder supplies.</li>
<li>Benefit: Avoids stockouts and maintains continuity in operations.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Create ServiceNow Workflow" duration="5">
        <p>In this quickstart, we will implement <strong>Use Case 2: IT Operations / Infrastructure</strong>.</p>
<p>IoT sensor data from manufacturing devices is ingested into Snowflake for real-time monitoring. When specific thresholds are breached, a record is inserted into the <strong>device_signals</strong> table, indicating a potential issue. This event then triggers a ServiceNow workflow that creates an incident, which is subsequently assigned to the on-call field agent.</p>
<p>Let&#39;s begin by defining a workflow in ServiceNow to respond to the incoming trigger.</p>
<ol type="1">
<li>Navigate to your ServiceNow Personal Developer Instance -&gt; All -&gt; Workflow Studio -&gt; Homepage</li>
<li>Select New -&gt; Flow. Define a name for the flow &#34;snowdemo&#34;. Leave the rest as default.</li>
</ol>
<p class="image-container"><img alt="step1-new-flow" src="img/4ac609762b1ef2.png"></p>
<ol type="1" start="3">
<li>Choose a trigger for the flow. Go to Application -&gt; REST API - Asynchronous</li>
</ol>
<p class="image-container"><img alt="step1-create-trigger" src="img/c68a9bc7e9c24e45.png"></p>
<p>Set the HTTP Method to &#34;POST&#34;</p>
<p>Check the box &#34;Requires Authentication&#34; to ensure that only authenticated users can trigger the workflow.</p>
<p>In the Request Content Body, create the following variables:</p>
<p>Device_ID - This will be the ID for the device from the plant. Reading_ID - This will be the ID for the reading that triggered the event Description - This will be a brief description of the event that occured Category - This will be the category of the error eg. ‘Hardware&#39;, ‘Software&#39; etc<br> Impact - The likely impact of the event such as ‘1-High&#39;, ‘2-Medium&#39; etc</p>
<p>You may optionally add headers or roles for the REST request, but we&#39;ll skip that for this tutorial.</p>
<p>Click &#34;Done&#34;.</p>
<p>Your trigger definition should now look like this: <img alt="step1-snowflake-trigger" src="img/b166e1df521e3b8a.png"></p>
<p>Now that the trigger is configured, the next step is to define the action for the workflow — creating an incident record.</p>
<p>Select Action → Create Record → Table: incident</p>
<p>In this example, we&#39;ve added custom fields to the incident table to capture IoT-specific data like Device_ID and Reading_ID. You can add new fields to a ServiceNow table using this guide: <a href="https://www.servicenow.com/docs/bundle/yokohama-platform-administration/page/administer/field-administration/task/t_CreatingNewFields.html#:~:text=Define%20a%20task%20relationship%20allowed,Use%20disjunctions%20in%20complex%20queries" target="_blank">Add New Field</a></p>
<p>Map the fields in the incident record to the input variables received in the inbound REST request.</p>
<p>Use the Data Pill Picker to set the values for each field:</p>
<p>Navigate to Data Pill Picker → Trigger → REST API - Asynchronous → Request Body → Field Name</p>
<p class="image-container"><img alt="step2-data-pill-picker" src="img/69445a0b21852180.png"></p>
<p>Once you&#39;ve mapped all fields, your action definition should resemble this:</p>
<p class="image-container"><img alt="step2-incident-record" src="img/842b8eddd17a9df9.png"></p>
<p>Click Done. This completes your workflow definition in ServiceNow.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create Connection to ServiceNow" duration="4">
        <p>Now that the ServiceNow workflow is defined, the next step is to create a connection from Snowflake to your ServiceNow instance. To do this, we will leverage a few Snowflake primitives that enable secure, external API access:</p>
<p><strong>Snowflake Secret</strong>: Used to securely store authentication credentials for the ServiceNow instance (e.g., username and password).</p>
<p><strong>External Access Integration</strong>: Enables Snowflake to securely make external REST API calls to ServiceNow from within a stored procedure or UDF.</p>
<pre><code language="language-sql" class="language-sql">CREATE OR REPLACE  SECRET servicenowkey
   TYPE = PASSWORD
  USERNAME = &#39;admin&#39;
  PASSWORD = &#39;Password for your servicenow user&#39;
 COMMENT = &#39;secret for servicenow api access&#39; ;

</code></pre>
<p>Next, you need to define a network rule that identifies the ServiceNow instance by hostname. This rule will be referenced in the external access integration to allow Snowflake to securely communicate with the specified ServiceNow endpoint.</p>
<pre><code language="language-sql" class="language-sql">  CREATE OR REPLACE NETWORK RULE servicenow_apis_network_rule
  MODE = EGRESS
  TYPE = HOST_PORT
  VALUE_LIST = (&#39;InstanceID.service-now.com&#39;);


  CREATE OR REPLACE EXTERNAL ACCESS INTEGRATION servicenow_apis_access_integration
  ALLOWED_NETWORK_RULES = (servicenow_apis_network_rule)
  ALLOWED_AUTHENTICATION_SECRETS = (servicenowkey)
  ENABLED = true;

</code></pre>
<p>This completes the connection to ServiceNow.</p>
<p>We also need to create a table to store all the events on which alerts will be triggered. To build a sample events table for the use case, run the SQL statement below. This will create a <strong>device_signals</strong> table that simulates a manufacturing plant environment and stores entries whenever a trigger condition—such as &#34;device temperature too high&#34;—occurs.</p>
<pre><code language="language-sql" class="language-sql">create database iot_demo; 

use database iot_demo; 

create or replace schema public; 

CREATE OR REPLACE TABLE device_signals (
    signal_id STRING PRIMARY KEY,
    device_id STRING REFERENCES devices(device_id),
    reading_id STRING REFERENCES device_readings(reading_id),
    signal_type STRING,
    category STRING,
    impact STRING,
    timestamp TIMESTAMP
);

</code></pre>
<p>We will also create a table to store all the workflow executions and the corresponding event details.</p>
<pre><code language="language-sql" class="language-sql">CREATE OR REPLACE TABLE workflow_log (
    device_id STRING,
    reading_id STRING,
    signal_type STRING,
    category STRING,
    impact STRING,
    workflow_execution_id STRING,
    execution_time TIMESTAMP_TZ);
    
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Create Snowflake Alert" duration="4">
        <p>So far, we have the workflow set up in ServiceNow and the device_signals table created in Snowflake. Next, we need to define an alert that will be triggered when a specified condition occurs. This alert will call a UDF that passes the event details and starts the corresponding workflow in ServiceNow.</p>
<p>The exact method for detecting an impending issue is beyond the scope of this quickstart. It could be based on business rules (e.g., temperature exceeding a certain threshold) or a predictive model built using Snowflake Cortex that evaluates multiple parameters to identify potential device failures.</p>
<p>Let&#39;s begin by creating the UDF, as we&#39;ll be referencing it in the alert definition.</p>
<pre><code language="language-sql" class="language-sql">CREATE OR REPLACE FUNCTION servicenow_action(device_id STRING,reading_id STRING,signal_type STRING,
category STRING,impact STRING )
RETURNS String
LANGUAGE PYTHON
EXTERNAL_ACCESS_INTEGRATIONS = (servicenow_apis_access_integration)
SECRETS = (&#39;cred&#39; = servicenowkey)
RUNTIME_VERSION = 3.9
HANDLER = &#39;call_servicenow_flow&#39;
PACKAGES = (&#39;pandas&#39;, &#39;requests&#39;)
AS $$

import json
import requests
import _snowflake
from requests.auth import HTTPBasicAuth

session = requests.Session()


def call_servicenow_flow(device_id,reading_id,signal_type,category,impact):
    payload={}
# The full path for the REST API endpoint we created in Step 1 
    url = &#34;https://InstanceID.service-now.com/api/1551828/snowdemo&#34;

# Optional Headers for the API call if you have defined them in the REST API 
    headers = {
        &#34;Accept&#34;: &#34;application/json&#34;,
        &#34;Content-Type&#34;: &#34;application/json&#34;
        }

# Payload for the POST request
    data = {
        &#34;Device_ID&#34;  : device_id,
        &#34;Reading_ID&#34;: reading_id,
        &#34;Description&#34;:signal_type,
        &#34;Category&#34;:category,
        &#34;Impact&#34;:impact
        }


    # Username and password from snowflake secret we defined earlier
    username_password_object = _snowflake.get_username_password(&#39;cred&#39;);
    basic = HTTPBasicAuth(username_password_object.username, username_password_object.password)


 
    response = session.post(url,headers=headers,json=data,auth=basic)

    if response.status_code == 202:
        json_result=response.json()
        executionId=json_result[&#34;result&#34;][&#34;executionId&#34;]
        return executionId
    else:
        error_string=&#34;Rest call failed. Please check Servicenow endpoint&#34;
        return (error_string)
$$

</code></pre>
<p>Now let&#39;s define the alert. This is a Snowflake feature that can be automatically activated by new rows in a table, rather than relying on a set schedule. For every new row inserted or updated, you can define a condition—and if that condition is met, the alert is triggered. There&#39;s no need to specify a schedule or continuously poll the table.</p>
<p>In our case, when an event with a potential <strong>‘1-High&#39;</strong> impact is inserted into the <strong>device_signals</strong> table, the alert is fired. As part of its action, the alert starts the workflow in ServiceNow using the function we defined earlier.</p>
<pre><code language="language-sql" class="language-sql">CREATE OR REPLACE ALERT device_alert
  IF( EXISTS(
    SELECT device_id,reading_id,signal_type,category,impact FROM device_signals where impact=&#39;1-High&#39;))
  THEN
    insert into  workflow_log
    SELECT device_id,reading_id,signal_type,category,impact,servicenow_action(device_id,reading_id,
    signal_type,category,impact),current_timestamp()  FROM device_signals where impact =&#39;1-High&#39;;

    ALTER TABLE device_signals SET CHANGE_TRACKING = TRUE;

</code></pre>
<p>This completes all the plumbing we need to put in place to trigger the workflow from snowflake.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Execute the Workflow" duration="2">
        <p>The final step is to test our integration. Since we&#39;ve defined the trigger condition as a <strong>‘1-High&#39;</strong> impact event being logged in the <strong>device_signals</strong> table, let&#39;s insert a record and verify that the corresponding incident is automatically created in ServiceNow—without any additional user intervention. This should also insert a record into the <strong>workflow_log</strong> table, capturing the execution ID of the ServiceNow workflow.</p>
<pre><code language="language-sql" class="language-sql">INSERT INTO device_signals (signal_id, device_id,reading_id, signal_type, category,impact, timestamp) VALUES
(&#39;SG1&#39;, &#39;D1056&#39;,&#39;R200&#39;,  &#39;Device temperature fluctuating rapidly&#39;,&#39;Hardware&#39;,&#39;1-High&#39;,current_timestamp());

</code></pre>
<p>You can query the <strong>workflow_log</strong> table to find the new row with the recorded readings, along with the execution ID that represents the workflow run in ServiceNow.</p>
<p>Next, log in to ServiceNow and check the incident that was created: Navigate to <strong>Workflow Studio → Workflow → Executions</strong>, select the latest execution, and review the corresponding incident record.</p>
<p>Voila! You now have an incident record created in ServiceNow—automatically triggered from Snowflake.</p>
<p class="image-container"><img alt="Incident-in-servicenow" src="img/919f972e11931619.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Conclusion And Resources" duration="2">
        <p>Congratulations—you&#39;ve made it to the end! In this quickstart, you learned how to automatically trigger a workflow in ServiceNow from Snowflake. Together, Snowflake and ServiceNow offer a powerful opportunity to streamline and enhance business operations by transforming raw data insights into actionable outcomes.</p>
<h2 is-upgraded>What You Learned</h2>
<ul>
<li>Create a workflow in ServiceNow to accept REST input.</li>
<li>Set up a connection from Snowflake to ServiceNow using external access.</li>
<li>Trigger the workflow from Snowflake based on a specific event condition.</li>
</ul>
<h2 is-upgraded>Kindly fill out the survey below for informational purposes only.</h2>
<p><a href="https://forms.gle/Y6kGwymDCueoz9g88" target="_blank">Survey</a></p>
<h2 is-upgraded>Related Resources</h2>
<ul>
<li><a href="https://www.servicenow.com/docs/bundle/xanadu-integrate-applications/page/administer/integrationhub/concept/rest-trigger.html" target="_blank">ServiceNow Trigger</a></li>
<li><a href="https://docs.snowflake.com/en/sql-reference/sql/create-external-access-integration" target="_blank">Snowflake External Access Integration</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/native-shim.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/custom-elements.min.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/prettify.js"></script>
  <script src="https://quickstarts.snowflake.com/elements/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("2025084205");
  </script>
</body>
</html>
